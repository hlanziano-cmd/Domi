<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Domicilios - Sistema Profesional</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%233B82F6' d='M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z'/></svg>">
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
            margin: 0; padding: 0; background-color: #f8fafc; line-height: 1.6;
        }
        .loading { 
            display: flex; justify-content: center; align-items: center; height: 100vh; 
            font-size: 18px; color: #6B7280; flex-direction: column; 
        }
        .spinner { 
            border: 3px solid #f3f4f6; border-top: 3px solid #3b82f6; border-radius: 50%; 
            width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 16px; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .metric-card { 
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; 
            cursor: pointer;
        }
        .metric-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); }
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            transition: all 0.3s ease; border: none; outline: none;
        }
        .btn-primary:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); 
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .notification { 
            position: fixed; top: 20px; right: 20px; z-index: 1000; 
            background: #10B981; color: white; padding: 12px 16px; 
            border-radius: 8px; font-size: 14px; font-weight: 500;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .whatsapp-btn { background: #25D366; }
        .whatsapp-btn:hover { background: #22C55E; }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
            <p>🚀 Iniciando Sistema de Control de Domicilios...</p>
            <small class="text-gray-400">Cargando interfaz profesional</small>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // 🎨 Iconos SVG optimizados
        const PlusCircle = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="16"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
        );

        const TrendingUp = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const Package = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="m7.5 4.27 9 5.15"></path>
                <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
                <path d="m3.3 7 8.7 5 8.7-5"></path>
                <path d="M12 22V12"></path>
            </svg>
        );

        const Users = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="m22 21-3-3"></path>
            </svg>
        );

        const MapPin = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const Star = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
            </svg>
        );

        const Clock = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12,6 12,12 16,14"></polyline>
            </svg>
        );

        const DollarSign = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const Navigation = ({ className = "w-3 h-3" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polygon points="3,11 22,2 13,21 11,13 3,11"></polygon>
            </svg>
        );

        const Smartphone = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                <line x1="12" y1="18" x2="12.01" y2="18"></line>
            </svg>
        );

        const AlertCircle = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        // 🛠️ Componente de Notificación
        const Notification = ({ message, type = 'success', onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };

            return (
                <div className={`notification ${colors[type]}`}>
                    {message}
                </div>
            );
        };

        // 📱 Componente principal
        const DeliverySystem = () => {
            // 🔄 Estados principales
            const [activeTab, setActiveTab] = useState('dashboard');
            const [orders, setOrders] = useState([]);
            const [deliveryPersons, setDeliveryPersons] = useState([]);
            const [locations, setLocations] = useState({});
            const [isDeliveryPersonView, setIsDeliveryPersonView] = useState(false);
            const [currentDeliveryPerson, setCurrentDeliveryPerson] = useState(null);
            const [loading, setLoading] = useState(true);
            const [notifications, setNotifications] = useState([]);

            // 📝 Estados de formularios
            const [newOrder, setNewOrder] = useState({
                customerName: '', address: '', orderValue: '', deliveryFee: '', 
                deliveryPerson: '', city: '', customerPhone: ''
            });

            const [newDeliveryPerson, setNewDeliveryPerson] = useState({
                name: '', phone: '+57 ', vehicle: 'moto'
            });

            // 🏙️ Ciudades principales de Colombia
            const colombianCities = [
                'Bogotá', 'Medellín', 'Cali', 'Barranquilla', 'Cartagena',
                'Cúcuta', 'Bucaramanga', 'Pereira', 'Santa Marta', 'Ibagué'
            ];

            // 🔔 Sistema de notificaciones
            const showNotification = useCallback((message, type = 'success') => {
                const id = Date.now();
                setNotifications(prev => [...prev, { id, message, type }]);
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== id));
                }, 3000);
            }, []);

            // 💾 Cargar datos iniciales
            useEffect(() => {
                const loadData = async () => {
                    try {
                        await new Promise(resolve => setTimeout(resolve, 1500)); // Simular carga
                        
                        const savedOrders = localStorage.getItem('deliveryOrders_v2');
                        const savedPersons = localStorage.getItem('deliveryPersons_v2');
                        const savedLocations = localStorage.getItem('deliveryLocations_v2');
                        
                        if (savedOrders) setOrders(JSON.parse(savedOrders));
                        if (savedPersons) setDeliveryPersons(JSON.parse(savedPersons));
                        if (savedLocations) setLocations(JSON.parse(savedLocations));

                        // 🔍 Verificar vista de repartidor
                        const urlParams = new URLSearchParams(window.location.search);
                        const repartidorId = urlParams.get('repartidor');
                        
                        if (repartidorId) {
                            setIsDeliveryPersonView(true);
                            // Buscar repartidor
                            setTimeout(() => {
                                const savedPersonsData = localStorage.getItem('deliveryPersons_v2');
                                if (savedPersonsData) {
                                    const persons = JSON.parse(savedPersonsData);
                                    const person = persons.find(p => p.id == repartidorId);
                                    if (person) {
                                        setCurrentDeliveryPerson(person);
                                        showNotification(`¡Bienvenido ${person.name}! 👋`, 'success');
                                    } else {
                                        showNotification('Repartidor no encontrado ❌', 'error');
                                    }
                                }
                            }, 100);
                        } else {
                            showNotification('¡Sistema cargado correctamente! 🚀', 'success');
                        }
                        
                        setLoading(false);
                    } catch (error) {
                        console.error('Error cargando datos:', error);
                        showNotification('Error cargando datos 🔧', 'error');
                        setLoading(false);
                    }
                };
                
                loadData();
            }, [showNotification]);

            // 💾 Guardar datos automáticamente
            useEffect(() => {
                if (!loading) {
                    try {
                        localStorage.setItem('deliveryOrders_v2', JSON.stringify(orders));
                    } catch (error) {
                        console.error('Error guardando pedidos:', error);
                        showNotification('Error guardando pedidos 💾', 'error');
                    }
                }
            }, [orders, loading, showNotification]);

            useEffect(() => {
                if (!loading) {
                    try {
                        localStorage.setItem('deliveryPersons_v2', JSON.stringify(deliveryPersons));
                    } catch (error) {
                        console.error('Error guardando repartidores:', error);
                    }
                }
            }, [deliveryPersons, loading]);

            useEffect(() => {
                if (!loading) {
                    try {
                        localStorage.setItem('deliveryLocations_v2', JSON.stringify(locations));
                    } catch (error) {
                        console.error('Error guardando ubicaciones:', error);
                    }
                }
            }, [locations, loading]);

            // 🛠️ Utilidades
            const formatNumber = (num) => {
                if (!num) return '0';
                return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            };

            const formatColombianPhone = (phone) => {
                if (!phone) return '+57 ';
                const cleanPhone = phone.replace(/\D/g, '');
                if (phone.startsWith('+57')) return phone;
                if (cleanPhone.length === 10) return `+57 ${cleanPhone}`;
                if (cleanPhone.length > 0) return `+57 ${cleanPhone}`;
                return '+57 ';
            };

            // 📍 Funciones de geolocalización
            const startTracking = useCallback((deliveryPersonId) => {
                if ('geolocation' in navigator) {
                    const watchId = navigator.geolocation.watchPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            setLocations(prev => ({
                                ...prev,
                                [deliveryPersonId]: {
                                    lat: latitude, lng: longitude,
                                    timestamp: new Date().toISOString(),
                                    accuracy: position.coords.accuracy
                                }
                            }));
                        },
                        (error) => {
                            console.error('Error GPS:', error);
                            showNotification('Error obteniendo GPS. Verifica permisos 📍', 'error');
                        },
                        { enableHighAccuracy: true, timeout: 15000, maximumAge: 30000 }
                    );
                    
                    setDeliveryPersons(prev => prev.map(person => 
                        person.id === deliveryPersonId 
                            ? { ...person, watchId, isTracking: true }
                            : person
                    ));
                    
                    showNotification('GPS activado correctamente 🛰️', 'success');
                } else {
                    showNotification('GPS no disponible en este dispositivo 📵', 'error');
                }
            }, [showNotification]);

            const stopTracking = useCallback((deliveryPersonId) => {
                const person = deliveryPersons.find(p => p.id === deliveryPersonId);
                if (person && person.watchId) {
                    navigator.geolocation.clearWatch(person.watchId);
                    setDeliveryPersons(prev => prev.map(p => 
                        p.id === deliveryPersonId 
                            ? { ...p, watchId: null, isTracking: false }
                            : p
                    ));
                    showNotification('GPS desactivado 📍', 'info');
                }
            }, [deliveryPersons, showNotification]);

            // 📊 Calcular métricas
            const calculateMetrics = useCallback(() => {
                if (orders.length === 0) return {
                    totalOrders: 0, totalRevenue: 0, avgDeliveryTime: 0, avgOrderValue: 0,
                    completionRate: 0, avgRating: 0, completedOrders: 0, 
                    activeOrders: 0, pendingOrders: 0
                };

                const completedOrders = orders.filter(order => order.status === 'entregado');
                const activeOrders = orders.filter(order => order.status === 'en_transito');
                const pendingOrders = orders.filter(order => order.status === 'pendiente');
                
                const totalRevenue = orders.reduce((sum, order) => 
                    sum + parseFloat(order.orderValue || 0), 0);
                const totalDeliveryFees = orders.reduce((sum, order) => 
                    sum + parseFloat(order.deliveryFee || 0), 0);
                
                const deliveryTimes = completedOrders
                    .filter(order => order.actualDeliveryTime)
                    .map(order => parseInt(order.actualDeliveryTime));
                const avgDeliveryTime = deliveryTimes.length > 0 
                    ? deliveryTimes.reduce((sum, time) => sum + time, 0) / deliveryTimes.length 
                    : 0;

                const ratings = completedOrders
                    .filter(order => order.rating)
                    .map(order => parseInt(order.rating));
                const avgRating = ratings.length > 0 
                    ? ratings.reduce((sum, rating) => sum + rating, 0) / ratings.length 
                    : 0;

                return {
                    totalOrders: orders.length,
                    completedOrders: completedOrders.length,
                    activeOrders: activeOrders.length,
                    pendingOrders: pendingOrders.length,
                    totalRevenue: totalRevenue + totalDeliveryFees,
                    avgDeliveryTime: Math.round(avgDeliveryTime),
                    avgOrderValue: orders.length > 0 ? totalRevenue / orders.length : 0,
                    completionRate: orders.length > 0 ? (completedOrders.length / orders.length) * 100 : 0,
                    avgRating: avgRating
                };
            }, [orders]);

            // 📦 Funciones de pedidos
            const handleAddOrder = useCallback(() => {
                if (!newOrder.customerName?.trim() || !newOrder.address?.trim() || !newOrder.orderValue) {
                    showNotification('Completa los campos obligatorios ⚠️', 'warning');
                    return;
                }

                const order = {
                    id: Date.now(),
                    ...newOrder,
                    customerName: newOrder.customerName.trim(),
                    address: newOrder.address.trim(),
                    orderValue: parseFloat(newOrder.orderValue),
                    deliveryFee: parseFloat(newOrder.deliveryFee || 0),
                    status: 'pendiente',
                    createdAt: new Date().toLocaleString(),
                    updatedAt: new Date().toLocaleString()
                };

                setOrders(prev => [order, ...prev]);
                setNewOrder({
                    customerName: '', address: '', orderValue: '', deliveryFee: '', 
                    deliveryPerson: '', city: '', customerPhone: ''
                });
                
                showNotification(`✅ Pedido creado para ${order.customerName}`, 'success');
            }, [newOrder, showNotification]);

            const handleAddDeliveryPerson = useCallback(() => {
                if (!newDeliveryPerson.name?.trim()) {
                    showNotification('Ingresa el nombre del repartidor ⚠️', 'warning');
                    return;
                }

                const person = {
                    id: Date.now(),
                    ...newDeliveryPerson,
                    name: newDeliveryPerson.name.trim(),
                    createdAt: new Date().toLocaleString(),
                    isTracking: false,
                    totalDeliveries: 0
                };

                setDeliveryPersons(prev => [person, ...prev]);
                setNewDeliveryPerson({ name: '', phone: '+57 ', vehicle: 'moto' });
                
                showNotification(`👤 Repartidor ${person.name} agregado`, 'success');
            }, [newDeliveryPerson, showNotification]);

            const handleDeleteDeliveryPerson = useCallback((personId) => {
                const person = deliveryPersons.find(p => p.id === personId);
                if (!person) return;

                const hasActiveOrders = orders.some(order => 
                    order.deliveryPerson === person.name && 
                    (order.status === 'pendiente' || order.status === 'en_transito')
                );

                if (hasActiveOrders) {
                    showNotification('No se puede eliminar: tiene pedidos activos ❌', 'error');
                    return;
                }

                if (confirm(`¿Eliminar a ${person.name}? Esta acción no se puede deshacer.`)) {
                    stopTracking(personId);
                    setDeliveryPersons(prev => prev.filter(p => p.id !== personId));
                    setLocations(prev => {
                        const newLoc = {...prev};
                        delete newLoc[personId];
                        return newLoc;
                    });
                    showNotification(`🗑️ Repartidor ${person.name} eliminado`, 'info');
                }
            }, [deliveryPersons, orders, stopTracking, showNotification]);

            const updateOrderStatus = useCallback((orderId, newStatus) => {
                setOrders(prev => prev.map(order => 
                    order.id === orderId 
                        ? { 
                            ...order, 
                            status: newStatus, 
                            updatedAt: new Date().toLocaleString(),
                            ...(newStatus === 'en_transito' ? { acceptedAt: new Date().toLocaleString() } : {})
                        }
                        : order
                ));

                const statusMessages = {
                    'en_transito': '🚚 Pedido enviado',
                    'entregado': '✅ Pedido completado'
                };
                
                if (statusMessages[newStatus]) {
                    showNotification(statusMessages[newStatus], 'success');
                }
            }, [showNotification]);

            const completeDelivery = useCallback((orderId, deliveryTime, rating) => {
                setOrders(prev => prev.map(order => 
                    order.id === orderId 
                        ? { 
                            ...order, 
                            status: 'entregado', 
                            actualDeliveryTime: deliveryTime, 
                            rating: rating,
                            completedAt: new Date().toLocaleString(),
                            updatedAt: new Date().toLocaleString()
                        }
                        : order
                ));
                
                showNotification('🎉 Entrega completada exitosamente', 'success');
            }, [showNotification]);

            // 🔗 Funciones de URLs y WhatsApp mejoradas
            const generateTrackingLink = useCallback((orderId) => {
                const order = orders.find(o => o.id === orderId);
                if (!order?.deliveryPerson) return null;
                
                const person = deliveryPersons.find(p => p.name === order.deliveryPerson);
                if (!person || !locations[person.id]) return null;
                
                const location = locations[person.id];
                return `https://maps.google.com/maps?q=${location.lat},${location.lng}`;
            }, [orders, deliveryPersons, locations]);

            const generateDeliveryPersonUrl = useCallback((personId) => {
                // Detectar si estamos en archivo local o servidor web
                const protocol = window.location.protocol;
                const hostname = window.location.hostname;
                
                if (protocol === 'file:') {
                    // Para archivos locales, crear una URL temporal usando GitHub Pages o similar
                    // El usuario debe subir el archivo a un servicio gratuito
                    const fileName = window.location.pathname.split('/').pop() || 'sistema-domicilios.html';
                    
                    // Mostrar instrucciones para subir el archivo
                    const instructions = `
🚨 ARCHIVO LOCAL DETECTADO 🚨

Para que los repartidores puedan acceder desde sus celulares, 
necesitas subir este archivo a un servidor web gratuito:

📁 OPCIONES GRATUITAS:

1️⃣ GITHUB PAGES (Recomendado):
   • Crear cuenta en github.com
   • Crear repositorio público
   • Subir el archivo como "index.html"  
   • Activar GitHub Pages
   • URL será: https://tuusuario.github.io/turepo

2️⃣ NETLIFY DROP:
   • Ir a app.netlify.com/drop
   • Arrastrar el archivo HTML
   • URL automática generada

3️⃣ VERCEL:
   • Crear cuenta en vercel.com
   • Subir archivo
   • URL automática

4️⃣ FIREBASE HOSTING:
   • Crear proyecto en Firebase
   • Subir archivo
   • URL personalizada

💡 MIENTRAS TANTO:
Puedes enviar el archivo directamente al repartidor 
y que lo abra en su navegador móvil.
                    `;
                    
                    // Mostrar las instrucciones
                    setTimeout(() => {
                        if (confirm('⚠️ Archivo local detectado. ¿Quieres ver las instrucciones para subirlo a un servidor gratuito?')) {
                            alert(instructions);
                        }
                    }, 500);
                    
                    // Generar URL temporal que el usuario puede reemplazar manualmente
                    return `https://TU-SITIO-WEB.com/${fileName}?repartidor=${personId}`;
                } else {
                    // Si está en servidor web, generar URL normal
                    const port = window.location.port ? `:${window.location.port}` : '';
                    const fileName = window.location.pathname.split('/').pop() || '';
                    return `${protocol}//${hostname}${port}${window.location.pathname}?repartidor=${personId}`;
                }
            }, []);

            const copyDeliveryPersonUrl = useCallback((personId, personName) => {
                const url = generateDeliveryPersonUrl(personId);
                
                // Verificar si es archivo local
                if (window.location.protocol === 'file:') {
                    // Para archivos locales, ofrecer opciones
                    const options = `
🚀 OPCIONES PARA ${personName.toUpperCase()}:

OPCIÓN 1 - SERVIDOR WEB (Recomendado):
Sube este archivo a un servidor gratuito y reemplaza la URL:

${url}

OPCIÓN 2 - ENVÍO DIRECTO:
Envía el archivo HTML directamente al repartidor por WhatsApp.

OPCIÓN 3 - COMPARTIR CARPETA:
Comparte la carpeta con el archivo por Google Drive o similar.

¿Qué opción prefieres?
                    `;
                    
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(url).then(() => {
                            showNotification(`📱 URL temporal copiada para ${personName}`, 'warning');
                            
                            setTimeout(() => {
                                const choice = confirm(options + '\n\n¿Quieres ver las instrucciones detalladas para subir a servidor web?');
                                if (choice) {
                                    showServerInstructions();
                                } else {
                                    // Crear WhatsApp con instrucciones para envío directo
                                    const directMessage = encodeURIComponent(
                                        `¡Hola ${personName}! 👋\n\n` +
                                        `Te envío el sistema de domicilios para que puedas trabajar.\n\n` +
                                        `📱 INSTRUCCIONES:\n\n` +
                                        `1. Descarga el archivo adjunto\n` +
                                        `2. Ábrelo en tu navegador móvil (Chrome, Safari, etc.)\n` +
                                        `3. Activa GPS cuando te lo pida\n` +
                                        `4. Acepta pedidos y contacta clientes\n\n` +
                                        `💡 IMPORTANTE:\n` +
                                        `• Mantén el archivo guardado en tu celular\n` +
                                        `• Funciona sin internet después de cargarlo\n` +
                                        `• Todos tus datos se guardan localmente\n\n` +
                                        `¡Cualquier duda, escríbeme! 📞`
                                    );
                                    
                                    window.open(`https://wa.me/?text=${directMessage}`, '_blank');
                                }
                            }, 1000);
                        });
                    } else {
                        alert('URL copiada: ' + url + '\n\n' + options);
                    }
                } else {
                    // Para servidores web, funcionar normal
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(url).then(() => {
                            showNotification(`📱 URL copiada para ${personName}`, 'success');
                            
                            setTimeout(() => {
                                const whatsappMessage = encodeURIComponent(
                                    `¡Hola ${personName}! 👋\n\n` +
                                    `Usa este enlace para gestionar tus entregas:\n` +
                                    `${url}\n\n` +
                                    `Con este enlace puedes:\n` +
                                    `✅ Ver tus pedidos asignados\n` +
                                    `🛰️ Activar tu GPS\n` +
                                    `💬 Contactar clientes por WhatsApp\n` +
                                    `📦 Marcar entregas completadas\n\n` +
                                    `¡Guarda este enlace en tus favoritos! 📱`
                                );
                                
                                if (confirm(`¿Quieres enviar las instrucciones por WhatsApp a ${personName}?`)) {
                                    window.open(`https://wa.me/?text=${whatsappMessage}`, '_blank');
                                }
                            }, 1000);
                        });
                    } else {
                        prompt(`URL para ${personName}:`, url);
                    }
                }
            }, [generateDeliveryPersonUrl, showNotification]);

            // Función para mostrar instrucciones de servidor
            const showServerInstructions = useCallback(() => {
                const instructions = `
🚀 CÓMO SUBIR A SERVIDOR WEB GRATUITO:

═══ OPCIÓN 1: GITHUB PAGES (Más fácil) ═══

1. Ir a github.com y crear cuenta gratis
2. Hacer clic "New repository" 
3. Nombre: "sistema-domicilios" (o el que prefieras)
4. Marcar "Public" y "Add README"
5. Hacer clic "Create repository"
6. Hacer clic "uploading an existing file"
7. Arrastrar tu archivo HTML
8. Renombrarlo a "index.html"
9. Hacer clic "Commit changes"
10. Ir a Settings > Pages
11. En "Source" seleccionar "Deploy from a branch"
12. Seleccionar "main" branch
13. Hacer clic "Save"
14. ¡Tu URL será: https://tuusuario.github.io/sistema-domicilios/

═══ OPCIÓN 2: NETLIFY (Más rápido) ═══

1. Ir a app.netlify.com/drop
2. Arrastrar tu archivo HTML
3. ¡Listo! Te da una URL automáticamente
4. Puedes personalizar el nombre después

═══ OPCIÓN 3: VERCEL ═══

1. Ir a vercel.com y crear cuenta
2. Hacer clic "New Project"
3. Subir archivo HTML
4. ¡Deploy automático!

💡 RECOMENDACIÓN:
Usa GitHub Pages porque es gratis, confiable y fácil de actualizar.

¿Necesitas ayuda con algún paso?
                `;
                
                alert(instructions);
            }, []);

            // 🚚 Funciones específicas para repartidores mejoradas
            const openWhatsApp = useCallback((customerPhone, customerName, address) => {
                if (!customerPhone) {
                    showNotification('❌ No hay teléfono registrado para este cliente', 'warning');
                    return;
                }
                
                // Limpiar número telefónico
                const cleanPhone = customerPhone.replace(/\D/g, '');
                
                // Verificar que tenga el formato correcto (10 dígitos después del +57)
                if (cleanPhone.length < 10) {
                    showNotification('❌ Número telefónico incompleto', 'warning');
                    return;
                }
                
                // Tomar los últimos 10 dígitos si es necesario
                const phoneNumber = cleanPhone.slice(-10);
                
                const message = encodeURIComponent(
                    `¡Hola ${customerName}! 👋\n\n` +
                    `Soy tu repartidor de domicilios. 🚚\n\n` +
                    `Estoy en camino con tu pedido a:\n📍 ${address}\n\n` +
                    `¿Hay alguna indicación especial para la entrega?\n` +
                    `(Apartamento, piso, punto de referencia, etc.)\n\n` +
                    `¡Gracias por tu preferencia! 😊`
                );
                
                // URL de WhatsApp con código de país colombiano
                const whatsappUrl = `https://wa.me/57${phoneNumber}?text=${message}`;
                
                try {
                    window.open(whatsappUrl, '_blank');
                    showNotification('💬 WhatsApp abierto correctamente', 'success');
                } catch (error) {
                    showNotification('❌ Error al abrir WhatsApp', 'error');
                    console.error('Error:', error);
                }
            }, [showNotification]);

            // 📱 Función para crear enlace de WhatsApp para instruir al repartidor
            const createWhatsAppInstructionsLink = useCallback((personName, personUrl) => {
                const message = encodeURIComponent(
                    `¡Hola ${personName}! 👋 Instrucciones para trabajar:\n\n` +
                    `🔗 Tu enlace personal:\n${personUrl}\n\n` +
                    `📋 INSTRUCCIONES:\n\n` +
                    `1. 🛰️ ACTIVAR GPS:\n` +
                    `   • Abrir el enlace en tu celular\n` +
                    `   • Hacer clic en "Activar GPS"\n` +
                    `   • Aceptar permisos de ubicación\n\n` +
                    `2. 📦 ACEPTAR PEDIDOS:\n` +
                    `   • Ver pedidos pendientes\n` +
                    `   • Hacer clic "Aceptar Pedido"\n` +
                    `   • GPS se activa automáticamente\n\n` +
                    `3. 💬 CONTACTAR CLIENTES:\n` +
                    `   • Botón "WhatsApp" en cada pedido\n` +
                    `   • Mensaje automático incluido\n` +
                    `   • Confirmar detalles de entrega\n\n` +
                    `4. ✅ COMPLETAR ENTREGAS:\n` +
                    `   • Hacer clic "Marcar como Entregado"\n` +
                    `   • Ingresar tiempo de entrega\n` +
                    `   • Pedido se marca automáticamente\n\n` +
                    `💡 IMPORTANTE:\n` +
                    `• Mantén el GPS activo mientras trabajas\n` +
                    `• Guarda este enlace en tus favoritos\n` +
                    `• Solo funciona cuando aceptas permisos\n\n` +
                    `¡Cualquier duda, escríbeme! 📱`
                );
                
                return `https://wa.me/?text=${message}`;
            }, []);

            const acceptOrder = useCallback((orderId) => {
                updateOrderStatus(orderId, 'en_transito');
                if (currentDeliveryPerson && !currentDeliveryPerson.isTracking) {
                    setTimeout(() => startTracking(currentDeliveryPerson.id), 500);
                }
                showNotification('✅ Pedido aceptado! GPS activándose...', 'success');
            }, [updateOrderStatus, currentDeliveryPerson, startTracking, showNotification]);

            const completeOrderByDeliveryPerson = useCallback((orderId) => {
                const time = prompt('¿Cuántos minutos tardaste en entregar? (ejemplo: 25)');
                if (time && !isNaN(time) && time > 0) {
                    completeDelivery(orderId, time, 5); // Calificación automática de 5
                    showNotification('🎉 ¡Entrega registrada exitosamente!', 'success');
                } else if (time !== null) {
                    showNotification('Por favor ingresa un tiempo válido', 'warning');
                }
            }, [completeDelivery, showNotification]);

            const metrics = calculateMetrics();

            // 📱 Vista especial para repartidores
            if (isDeliveryPersonView && currentDeliveryPerson) {
                const myOrders = orders.filter(order => order.deliveryPerson === currentDeliveryPerson.name);
                const pendingOrders = myOrders.filter(order => order.status === 'pendiente');
                const activeOrders = myOrders.filter(order => order.status === 'en_transito');
                const completedTodayOrders = myOrders.filter(order => 
                    order.status === 'entregado' && 
                    order.completedAt && 
                    new Date(order.completedAt).toDateString() === new Date().toDateString()
                );

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50">
                        {/* Notificaciones */}
                        {notifications.map(notification => (
                            <Notification
                                key={notification.id}
                                message={notification.message}
                                type={notification.type}
                                onClose={() => setNotifications(prev => prev.filter(n => n.id !== notification.id))}
                            />
                        ))}

                        {/* Header para repartidor */}
                        <div className="bg-white shadow-lg border-b border-gray-200">
                            <div className="max-w-4xl mx-auto px-4 py-6">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center space-x-4">
                                        <div className="w-12 h-12 bg-gradient-to-r from-blue-500 to-green-500 rounded-full flex items-center justify-center shadow-lg">
                                            <Users className="w-6 h-6 text-white" />
                                        </div>
                                        <div>
                                            <h1 className="text-2xl font-bold text-gray-900">
                                                ¡Hola {currentDeliveryPerson.name}! 👋
                                            </h1>
                                            <p className="text-gray-600">
                                                Panel de Repartidor - {new Date().toLocaleDateString('es-CO', {
                                                    weekday: 'long',
                                                    year: 'numeric',
                                                    month: 'long',
                                                    day: 'numeric'
                                                })}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className={`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium shadow-sm ${
                                            currentDeliveryPerson.isTracking 
                                                ? 'bg-green-100 text-green-800 border-2 border-green-200' 
                                                : 'bg-red-100 text-red-800 border-2 border-red-200'
                                        }`}>
                                            <div className={`w-2 h-2 rounded-full mr-2 ${
                                                currentDeliveryPerson.isTracking ? 'bg-green-500 pulse' : 'bg-red-500'
                                            }`}></div>
                                            {currentDeliveryPerson.isTracking ? 'GPS Activo 🛰️' : 'GPS Inactivo 📍'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="max-w-4xl mx-auto px-4 py-8 space-y-6">
                            {/* Estadísticas rápidas */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 fade-in">
                                <div className="bg-gradient-to-r from-yellow-50 to-yellow-100 border-2 border-yellow-200 rounded-xl p-6 text-center shadow-lg">
                                    <div className="text-3xl font-bold text-yellow-600 mb-2">{pendingOrders.length}</div>
                                    <div className="text-sm font-medium text-yellow-800">📦 Pedidos Pendientes</div>
                                </div>
                                <div className="bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-xl p-6 text-center shadow-lg">
                                    <div className="text-3xl font-bold text-blue-600 mb-2">{activeOrders.length}</div>
                                    <div className="text-sm font-medium text-blue-800">🚚 En Tránsito</div>
                                </div>
                                <div className="bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-xl p-6 text-center shadow-lg">
                                    <div className="text-3xl font-bold text-green-600 mb-2">{completedTodayOrders.length}</div>
                                    <div className="text-sm font-medium text-green-800">✅ Completados Hoy</div>
                                </div>
                            </div>

                            {/* Control de GPS */}
                            <div className="bg-white rounded-xl shadow-lg border border-gray-200 p-6 fade-in">
                                <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <Smartphone className="mr-2 text-blue-500" />
                                    🛰️ Control de Ubicación GPS
                                </h3>
                                <div className="flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border border-gray-200">
                                    <div>
                                        <p className="font-medium text-gray-900">Estado del GPS</p>
                                        <p className="text-sm text-gray-600">
                                            {currentDeliveryPerson.isTracking 
                                                ? '🟢 Tu ubicación se está compartiendo en tiempo real' 
                                                : '🔴 Activa el GPS para comenzar el seguimiento'
                                            }
                                        </p>
                                        {locations[currentDeliveryPerson.id] && (
                                            <p className="text-xs text-green-600 mt-1 font-medium">
                                                📍 Última actualización: {new Date(locations[currentDeliveryPerson.id].timestamp).toLocaleTimeString()}
                                            </p>
                                        )}
                                    </div>
                                    <div className="flex space-x-3">
                                        {!currentDeliveryPerson.isTracking ? (
                                            <button
                                                onClick={() => startTracking(currentDeliveryPerson.id)}
                                                className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                            >
                                                <Navigation className="w-4 h-4" />
                                                <span>🛰️ Activar GPS</span>
                                            </button>
                                        ) : (
                                            <button
                                                onClick={() => stopTracking(currentDeliveryPerson.id)}
                                                className="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium shadow-lg transform transition-transform hover:scale-105"
                                            >
                                                ⏹️ Detener GPS
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* Pedidos pendientes */}
                            {pendingOrders.length > 0 && (
                                <div className="bg-white rounded-xl shadow-lg border border-gray-200 fade-in">
                                    <div className="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-yellow-50 to-orange-50">
                                        <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                            <Package className="mr-2 text-yellow-500" />
                                            📦 Pedidos Pendientes ({pendingOrders.length})
                                        </h3>
                                    </div>
                                    <div className="p-6 space-y-4">
                                        {pendingOrders.map(order => (
                                            <div key={order.id} className="border-2 border-yellow-200 rounded-lg p-6 bg-gradient-to-r from-yellow-50 to-yellow-100 shadow-md">
                                                <div className="flex justify-between items-start mb-4">
                                                    <div className="space-y-2">
                                                        <h4 className="font-bold text-lg text-gray-900">👤 {order.customerName}</h4>
                                                        <p className="text-gray-700 flex items-center">
                                                            <MapPin className="w-4 h-4 mr-1 text-red-500" />
                                                            {order.address}
                                                        </p>
                                                        <p className="text-gray-600">🏙️ {order.city || 'Ciudad no especificada'}</p>
                                                        <p className="text-lg font-bold text-green-600">💰 ${formatNumber(order.orderValue)}</p>
                                                        {order.deliveryFee > 0 && (
                                                            <p className="text-sm text-gray-600">📦 Envío: +${formatNumber(order.deliveryFee)}</p>
                                                        )}
                                                    </div>
                                                    <span className="bg-yellow-200 text-yellow-800 px-4 py-2 rounded-full text-sm font-bold shadow-sm">
                                                        ⏳ Pendiente
                                                    </span>
                                                </div>
                                                <div className="flex flex-wrap gap-3">
                                                    <button
                                                        onClick={() => acceptOrder(order.id)}
                                                        className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                                    >
                                                        <span>✅ Aceptar Pedido</span>
                                                    </button>
                                                    {order.customerPhone && (
                                                        <button
                                                            onClick={() => openWhatsApp(order.customerPhone, order.customerName, order.address)}
                                                            className="whatsapp-btn hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                                        >
                                                            <span>💬 Contactar Cliente</span>
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Pedidos en tránsito */}
                            {activeOrders.length > 0 && (
                                <div className="bg-white rounded-xl shadow-lg border border-gray-200 fade-in">
                                    <div className="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50">
                                        <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                            <Navigation className="mr-2 text-blue-500" />
                                            🚚 En Tránsito ({activeOrders.length})
                                        </h3>
                                    </div>
                                    <div className="p-6 space-y-4">
                                        {activeOrders.map(order => (
                                            <div key={order.id} className="border-2 border-blue-200 rounded-lg p-6 bg-gradient-to-r from-blue-50 to-blue-100 shadow-md">
                                                <div className="flex justify-between items-start mb-4">
                                                    <div className="space-y-2">
                                                        <h4 className="font-bold text-lg text-gray-900">👤 {order.customerName}</h4>
                                                        <p className="text-gray-700 flex items-center">
                                                            <MapPin className="w-4 h-4 mr-1 text-red-500" />
                                                            {order.address}
                                                        </p>
                                                        <p className="text-gray-600">🏙️ {order.city || 'Ciudad no especificada'}</p>
                                                        <p className="text-lg font-bold text-green-600">💰 ${formatNumber(order.orderValue)}</p>
                                                        {order.acceptedAt && (
                                                            <p className="text-sm text-blue-600 font-medium">⏰ Aceptado: {order.acceptedAt}</p>
                                                        )}
                                                    </div>
                                                    <span className="bg-blue-200 text-blue-800 px-4 py-2 rounded-full text-sm font-bold shadow-sm pulse">
                                                        🚚 En Tránsito
                                                    </span>
                                                </div>
                                                <div className="flex flex-wrap gap-3">
                                                    <button
                                                        onClick={() => completeOrderByDeliveryPerson(order.id)}
                                                        className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium shadow-lg transform transition-transform hover:scale-105"
                                                    >
                                                        🎉 Marcar como Entregado
                                                    </button>
                                                    {order.customerPhone && (
                                                        <button
                                                            onClick={() => openWhatsApp(order.customerPhone, order.customerName, order.address)}
                                                            className="whatsapp-btn hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium shadow-lg transform transition-transform hover:scale-105"
                                                        >
                                                            💬 WhatsApp
                                                        </button>
                                                    )}
                                                    {locations[currentDeliveryPerson.id] && (
                                                        <a
                                                            href={`https://maps.google.com/maps?q=${locations[currentDeliveryPerson.id].lat},${locations[currentDeliveryPerson.id].lng}`}
                                                            target="_blank"
                                                            rel="noopener noreferrer"
                                                            className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium shadow-lg transform transition-transform hover:scale-105"
                                                        >
                                                            🗺️ Mi Ubicación
                                                        </a>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Historial del día */}
                            {completedTodayOrders.length > 0 && (
                                <div className="bg-white rounded-xl shadow-lg border border-gray-200 fade-in">
                                    <div className="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-green-50 to-emerald-50">
                                        <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                            <Star className="mr-2 text-green-500" />
                                            ✅ Entregados Hoy ({completedTodayOrders.length})
                                        </h3>
                                    </div>
                                    <div className="p-6">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {completedTodayOrders.map(order => (
                                                <div key={order.id} className="border-2 border-green-200 rounded-lg p-4 bg-gradient-to-r from-green-50 to-green-100 shadow-sm">
                                                    <div className="flex justify-between items-start">
                                                        <div className="space-y-1">
                                                            <h5 className="font-medium text-gray-900">👤 {order.customerName}</h5>
                                                            <p className="text-sm text-gray-600">📍 {order.address}</p>
                                                            <p className="text-sm font-medium text-green-600">💰 ${formatNumber(order.orderValue)}</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <span className="bg-green-200 text-green-800 px-3 py-1 rounded-full text-xs font-bold">
                                                                ✅ Entregado
                                                            </span>
                                                            {order.actualDeliveryTime && (
                                                                <p className="text-xs text-gray-500 mt-1">
                                                                    ⏱️ {order.actualDeliveryTime} min
                                                                </p>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Sin pedidos */}
                            {myOrders.length === 0 && (
                                <div className="bg-white rounded-xl shadow-lg border border-gray-200 p-12 text-center fade-in">
                                    <Package className="w-20 h-20 text-gray-300 mx-auto mb-6" />
                                    <h3 className="text-2xl font-semibold text-gray-900 mb-3">📦 No tienes pedidos asignados</h3>
                                    <p className="text-gray-600 text-lg">Cuando te asignen pedidos, aparecerán aquí automáticamente.</p>
                                    <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                                        <p className="text-blue-800 font-medium">💡 Mantén activo tu GPS para recibir pedidos</p>
                                    </div>
                                </div>
                            )}

                            {/* Instrucciones */}
                            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-6 shadow-lg fade-in">
                                <h4 className="font-semibold text-blue-900 mb-4 flex items-center text-lg">
                                    📋 Instrucciones de Uso
                                </h4>
                                <div className="text-sm text-blue-800 space-y-3">
                                    <div className="flex items-start space-x-2">
                                        <span className="font-bold">1.</span>
                                        <span><strong>🛰️ Activa el GPS</strong> antes de salir a entregar pedidos</span>
                                    </div>
                                    <div className="flex items-start space-x-2">
                                        <span className="font-bold">2.</span>
                                        <span><strong>✅ Acepta los pedidos</strong> cuando estés listo para salir</span>
                                    </div>
                                    <div className="flex items-start space-x-2">
                                        <span className="font-bold">3.</span>
                                        <span><strong>💬 Usa WhatsApp</strong> para contactar a los clientes</span>
                                    </div>
                                    <div className="flex items-start space-x-2">
                                        <span className="font-bold">4.</span>
                                        <span><strong>🎉 Marca como entregado</strong> una vez completada la entrega</span>
                                    </div>
                                    <div className="flex items-start space-x-2">
                                        <span className="font-bold">5.</span>
                                        <span><strong>🔒 Tu privacidad:</strong> la ubicación solo se comparte cuando el GPS está activo</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // 🖥️ Mostrar loading
            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <p>🚀 Iniciando Sistema de Control de Domicilios...</p>
                        <small className="text-gray-400">Cargando interfaz profesional</small>
                    </div>
                );
            }

            // 🖱️ Componente de tarjeta de métrica
            const MetricCard = ({ title, value, icon: Icon, color, prefix = "", suffix = "", trend = null }) => (
                <div className="metric-card bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100 hover:border-gray-200 fade-in">
                    <div className="flex items-center justify-between">
                        <div className="flex-1">
                            <p className="text-sm font-medium text-gray-600 mb-1">{title}</p>
                            <p className="text-2xl font-bold text-gray-900 mb-1">
                                {prefix}{typeof value === 'number' ? formatNumber(value) : value}{suffix}
                            </p>
                            {trend && (
                                <p className={`text-xs font-medium ${trend > 0 ? 'text-green-600' : 'text-red-600'}`}>
                                    {trend > 0 ? '📈' : '📉'} {Math.abs(trend)}% vs período anterior
                                </p>
                            )}
                        </div>
                        <div className="ml-4 flex-shrink-0">
                            <div 
                                className="w-12 h-12 rounded-xl flex items-center justify-center shadow-md"
                                style={{ backgroundColor: color + '15' }}
                            >
                                <Icon className="w-6 h-6" style={{ color }} />
                            </div>
                        </div>
                    </div>
                </div>
            );

            const tabs = [
                { id: 'dashboard', name: 'Dashboard', icon: TrendingUp },
                { id: 'orders', name: 'Pedidos', icon: Package },
                { id: 'delivery', name: 'Repartidores', icon: Users },
                { id: 'tracking', name: 'Rastreo GPS', icon: MapPin },
                { id: 'analytics', name: 'Análisis', icon: Star }
            ];

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100">
                    {/* Notificaciones */}
                    {notifications.map(notification => (
                        <Notification
                            key={notification.id}
                            message={notification.message}
                            type={notification.type}
                            onClose={() => setNotifications(prev => prev.filter(n => n.id !== notification.id))}
                        />
                    ))}

                    {/* Header mejorado */}
                    <div className="bg-white shadow-lg border-b-2 border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-6">
                                <div className="flex items-center space-x-4">
                                    <div className="w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                        <Package className="w-6 h-6 text-white" />
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-900">Control de Domicilios</h1>
                                        <p className="text-sm text-gray-600">Sistema de gestión profesional v2.0</p>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <div className="text-sm text-gray-500">Actualizado en tiempo real</div>
                                    <div className="text-sm font-medium text-gray-900">
                                        {new Date().toLocaleDateString('es-CO')} - {new Date().toLocaleTimeString()}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Navigation mejorada */}
                    <div className="bg-white border-b-2 border-gray-100 sticky top-0 z-10 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <nav className="flex space-x-1 py-4">
                                {tabs.map(tab => {
                                    const Icon = tab.icon;
                                    const isActive = activeTab === tab.id;
                                    return (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`flex items-center space-x-2 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-300 ${
                                                isActive 
                                                    ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg transform scale-105' 
                                                    : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                            }`}
                                        >
                                            <Icon className="w-4 h-4" />
                                            <span>{tab.name}</span>
                                            {tab.id === 'orders' && orders.filter(o => o.status === 'pendiente').length > 0 && (
                                                <span className="bg-red-500 text-white text-xs rounded-full px-2 py-0.5 min-w-[20px] text-center font-bold">
                                                    {orders.filter(o => o.status === 'pendiente').length}
                                                </span>
                                            )}
                                        </button>
                                    );
                                })}
                            </nav>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        
                        {/* Dashboard Tab */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-8 fade-in">
                                {/* Welcome Section */}
                                <div className="text-center bg-gradient-to-r from-blue-50 via-purple-50 to-pink-50 rounded-2xl p-8 border-2 border-blue-100 shadow-lg">
                                    <h2 className="text-3xl font-bold text-gray-900 mb-3">
                                        🚀 Dashboard de Control Profesional
                                    </h2>
                                    <p className="text-gray-600 text-lg max-w-3xl mx-auto">
                                        Gestiona tus domicilios con seguimiento GPS en tiempo real, análisis avanzados y control total de tu operación. 
                                        Sistema optimizado para máxima eficiencia.
                                    </p>
                                </div>

                                {/* Métricas principales */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    <MetricCard
                                        title="Total Pedidos"
                                        value={metrics.totalOrders}
                                        icon={Package}
                                        color="#3B82F6"
                                        trend={metrics.totalOrders > 10 ? 12.5 : null}
                                    />
                                    <MetricCard
                                        title="Ingresos Totales"
                                        value={metrics.totalRevenue}
                                        icon={DollarSign}
                                        color="#10B981"
                                        prefix="$"
                                        trend={metrics.totalRevenue > 50000 ? 8.3 : null}
                                    />
                                    <MetricCard
                                        title="Tiempo Promedio"
                                        value={metrics.avgDeliveryTime}
                                        icon={Clock}
                                        color="#F59E0B"
                                        suffix=" min"
                                        trend={metrics.avgDeliveryTime > 0 ? -5.2 : null}
                                    />
                                    <MetricCard
                                        title="Calificación"
                                        value={metrics.avgRating.toFixed(1)}
                                        icon={Star}
                                        color="#EF4444"
                                        suffix="/5"
                                        trend={metrics.avgRating > 0 ? 2.1 : null}
                                    />
                                </div>

                                {/* Métricas secundarias */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <MetricCard
                                        title="Tasa de Completación"
                                        value={metrics.completionRate.toFixed(1)}
                                        icon={TrendingUp}
                                        color="#8B5CF6"
                                        suffix="%"
                                    />
                                    <MetricCard
                                        title="Valor Promedio Pedido"
                                        value={metrics.avgOrderValue}
                                        icon={DollarSign}
                                        color="#06B6D4"
                                        prefix="$"
                                    />
                                    <MetricCard
                                        title="Repartidores Activos"
                                        value={deliveryPersons.length}
                                        icon={Users}
                                        color="#84CC16"
                                    />
                                </div>

                                {/* Estado de pedidos en tiempo real */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-xl p-6 text-center shadow-lg">
                                        <div className="text-4xl font-bold text-green-600 mb-2">{metrics.completedOrders}</div>
                                        <div className="text-sm font-medium text-green-800">✅ Entregados</div>
                                        {metrics.completedOrders > 0 && <div className="text-xs text-green-600 mt-1">Completados exitosamente</div>}
                                    </div>
                                </div>

                                {/* Pedidos recientes */}
                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100">
                                    <div className="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100">
                                        <div className="flex justify-between items-center">
                                            <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                                <Package className="w-5 h-5 mr-2 text-blue-600" />
                                                📦 Pedidos Recientes
                                            </h3>
                                            {orders.length > 0 && (
                                                <button 
                                                    onClick={() => setActiveTab('orders')}
                                                    className="text-blue-600 hover:text-blue-800 text-sm font-medium bg-blue-50 px-3 py-1 rounded-lg transition-colors"
                                                >
                                                    Ver todos →
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ciudad</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Repartidor</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {orders.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="5" className="px-6 py-12 text-center">
                                                            <Package className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                                            <p className="text-gray-500 text-lg mb-4">📦 No hay pedidos registrados</p>
                                                            <button 
                                                                onClick={() => setActiveTab('orders')}
                                                                className="btn-primary text-white px-6 py-3 rounded-lg font-medium shadow-lg"
                                                            >
                                                                ➕ Crear Primer Pedido
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ) : (
                                                    orders.slice(0, 5).map(order => (
                                                        <tr key={order.id} className="hover:bg-gray-50 transition-colors">
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="font-medium text-gray-900">👤 {order.customerName}</div>
                                                                <div className="text-sm text-gray-500 truncate max-w-xs">📍 {order.address}</div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                                                🏙️ {order.city || '-'}
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                                💰 ${formatNumber(order.orderValue)}
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`inline-flex px-3 py-1 text-xs font-medium rounded-full ${
                                                                    order.status === 'entregado' ? 'bg-green-100 text-green-800' :
                                                                    order.status === 'en_transito' ? 'bg-blue-100 text-blue-800' :
                                                                    'bg-yellow-100 text-yellow-800'
                                                                }`}>
                                                                    {order.status === 'entregado' ? '✅ Entregado' :
                                                                     order.status === 'en_transito' ? '🚚 En Tránsito' : 
                                                                     '⏳ Pendiente'}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                                                👤 {order.deliveryPerson || 'No asignado'}
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* Acciones rápidas */}
                                <div className="bg-gradient-to-r from-blue-50 via-purple-50 to-pink-50 rounded-xl p-6 border-2 border-blue-100 shadow-lg">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-4">⚡ Acciones Rápidas</h3>
                                    <div className="flex flex-wrap gap-4">
                                        <button 
                                            onClick={() => setActiveTab('orders')}
                                            className="btn-primary text-white px-6 py-3 rounded-lg font-medium inline-flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                        >
                                            <PlusCircle className="w-4 h-4" />
                                            <span>📦 Nuevo Pedido</span>
                                        </button>
                                        <button 
                                            onClick={() => setActiveTab('delivery')}
                                            className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium inline-flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                        >
                                            <Users className="w-4 h-4" />
                                            <span>👤 Agregar Repartidor</span>
                                        </button>
                                        <button 
                                            onClick={() => setActiveTab('tracking')}
                                            className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium inline-flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                        >
                                            <MapPin className="w-4 h-4" />
                                            <span>🛰️ Ver GPS</span>
                                        </button>
                                        <button 
                                            onClick={() => setActiveTab('analytics')}
                                            className="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg font-medium inline-flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                        >
                                            <Star className="w-4 h-4" />
                                            <span>📊 Ver Análisis</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Orders Tab */}
                        {activeTab === 'orders' && (
                            <div className="space-y-6 fade-in">
                                {/* Formulario nuevo pedido */}
                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                        <PlusCircle className="w-5 h-5 mr-2 text-blue-600" />
                                        📦 Crear Nuevo Pedido
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">👤 Cliente *</label>
                                            <input
                                                type="text"
                                                placeholder="Nombre del cliente"
                                                value={newOrder.customerName}
                                                onChange={(e) => setNewOrder({...newOrder, customerName: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">📍 Dirección *</label>
                                            <input
                                                type="text"
                                                placeholder="Dirección de entrega"
                                                value={newOrder.address}
                                                onChange={(e) => setNewOrder({...newOrder, address: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">📞 Teléfono Cliente</label>
                                            <input
                                                type="text"
                                                placeholder="+57 300 123 4567"
                                                value={newOrder.customerPhone || ''}
                                                onChange={(e) => setNewOrder({...newOrder, customerPhone: formatColombianPhone(e.target.value)})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">🏙️ Ciudad</label>
                                            <select
                                                value={newOrder.city}
                                                onChange={(e) => setNewOrder({...newOrder, city: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            >
                                                <option value="">Seleccionar ciudad</option>
                                                {colombianCities.map(city => (
                                                    <option key={city} value={city}>{city}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">💰 Valor del pedido *</label>
                                            <input
                                                type="number"
                                                placeholder="Ej: 25000"
                                                value={newOrder.orderValue}
                                                onChange={(e) => setNewOrder({...newOrder, orderValue: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">📦 Costo de envío</label>
                                            <input
                                                type="number"
                                                placeholder="Ej: 3000"
                                                value={newOrder.deliveryFee}
                                                onChange={(e) => setNewOrder({...newOrder, deliveryFee: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">👤 Repartidor</label>
                                            <select
                                                value={newOrder.deliveryPerson}
                                                onChange={(e) => setNewOrder({...newOrder, deliveryPerson: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            >
                                                <option value="">Seleccionar repartidor</option>
                                                {deliveryPersons.map(person => (
                                                    <option key={person.id} value={person.name}>{person.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    <div className="mt-6 flex items-center space-x-3">
                                        <button
                                            onClick={handleAddOrder}
                                            className="btn-primary text-white px-6 py-3 rounded-lg font-medium inline-flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                        >
                                            <PlusCircle className="w-4 h-4" />
                                            <span>✅ Crear Pedido</span>
                                        </button>
                                        <span className="text-sm text-gray-500">* Campos obligatorios</span>
                                    </div>
                                </div>

                                {/* Lista de pedidos */}
                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100">
                                    <div className="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100">
                                        <div className="flex justify-between items-center">
                                            <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                                <Package className="w-5 h-5 mr-2 text-blue-600" />
                                                📋 Todos los Pedidos ({orders.length})
                                            </h3>
                                            <div className="flex items-center space-x-4 text-sm">
                                                <span className="text-yellow-600 font-medium">⏳ {metrics.pendingOrders} Pendientes</span>
                                                <span className="text-blue-600 font-medium">🚚 {metrics.activeOrders} En Tránsito</span>
                                                <span className="text-green-600 font-medium">✅ {metrics.completedOrders} Entregados</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Dirección</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ciudad</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {orders.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="6" className="px-6 py-12 text-center">
                                                            <Package className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                                            <p className="text-gray-500 text-lg mb-4">📦 No hay pedidos registrados</p>
                                                            <p className="text-sm text-gray-400">Crea tu primer pedido usando el formulario de arriba</p>
                                                        </td>
                                                    </tr>
                                                ) : (
                                                    orders.map(order => (
                                                        <tr key={order.id} className="hover:bg-gray-50 transition-colors">
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="font-medium text-gray-900">👤 {order.customerName}</div>
                                                                <div className="text-xs text-gray-500">🕒 {order.createdAt}</div>
                                                            </td>
                                                            <td className="px-6 py-4">
                                                                <div className="text-sm text-gray-900 max-w-xs truncate" title={order.address}>
                                                                    📍 {order.address}
                                                                </div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                                                🏙️ {order.city || '-'}
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="text-sm font-medium text-gray-900">💰 ${formatNumber(order.orderValue)}</div>
                                                                {order.deliveryFee > 0 && (
                                                                    <div className="text-xs text-gray-500">📦 +${formatNumber(order.deliveryFee)} envío</div>
                                                                )}
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`inline-flex px-3 py-1 text-xs font-medium rounded-full ${
                                                                    order.status === 'entregado' ? 'bg-green-100 text-green-800' :
                                                                    order.status === 'en_transito' ? 'bg-blue-100 text-blue-800' :
                                                                    'bg-yellow-100 text-yellow-800'
                                                                }`}>
                                                                    {order.status === 'entregado' ? '✅ Entregado' :
                                                                     order.status === 'en_transito' ? '🚚 En Tránsito' : 
                                                                     '⏳ Pendiente'}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                                <div className="flex items-center space-x-2">
                                                                    {order.status === 'pendiente' && (
                                                                        <button
                                                                            onClick={() => updateOrderStatus(order.id, 'en_transito')}
                                                                            className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-medium transition-colors"
                                                                        >
                                                                            🚚 Enviar
                                                                        </button>
                                                                    )}
                                                                    {order.status === 'en_transito' && (
                                                                        <>
                                                                            <button
                                                                                onClick={() => {
                                                                                    const time = prompt('Tiempo de entrega (minutos):');
                                                                                    const rating = prompt('Calificación del cliente (1-5):');
                                                                                    if (time && rating && rating >= 1 && rating <= 5) {
                                                                                        completeDelivery(order.id, time, rating);
                                                                                    } else if (time && rating) {
                                                                                        showNotification('La calificación debe estar entre 1 y 5', 'warning');
                                                                                    }
                                                                                }}
                                                                                className="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs font-medium transition-colors"
                                                                            >
                                                                                ✅ Completar
                                                                            </button>
                                                                            {generateTrackingLink(order.id) && (
                                                                                <a
                                                                                    href={generateTrackingLink(order.id)}
                                                                                    target="_blank"
                                                                                    rel="noopener noreferrer"
                                                                                    className="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-xs font-medium inline-flex items-center space-x-1 transition-colors"
                                                                                >
                                                                                    <MapPin className="w-3 h-3" />
                                                                                    <span>🛰️ GPS</span>
                                                                                </a>
                                                                            )}
                                                                        </>
                                                                    )}
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Delivery Tab */}
                        {activeTab === 'delivery' && (
                            <div className="space-y-6 fade-in">
                                {/* Formulario nuevo repartidor */}
                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                        <Users className="w-5 h-5 mr-2 text-green-600" />
                                        👤 Registrar Nuevo Repartidor
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">👤 Nombre completo *</label>
                                            <input
                                                type="text"
                                                placeholder="Nombre del repartidor"
                                                value={newDeliveryPerson.name}
                                                onChange={(e) => setNewDeliveryPerson({...newDeliveryPerson, name: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">📞 Teléfono</label>
                                            <input
                                                type="text"
                                                placeholder="+57 300 123 4567"
                                                value={newDeliveryPerson.phone}
                                                onChange={(e) => setNewDeliveryPerson({...newDeliveryPerson, phone: formatColombianPhone(e.target.value)})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">🚗 Vehículo</label>
                                            <select
                                                value={newDeliveryPerson.vehicle}
                                                onChange={(e) => setNewDeliveryPerson({...newDeliveryPerson, vehicle: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors"
                                            >
                                                <option value="moto">🏍️ Motocicleta</option>
                                                <option value="bicicleta">🚲 Bicicleta</option>
                                                <option value="carro">🚗 Automóvil</option>
                                                <option value="pie">🚶 A pie</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="mt-6 flex items-center space-x-3">
                                        <button
                                            onClick={handleAddDeliveryPerson}
                                            className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium inline-flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                        >
                                            <PlusCircle className="w-4 h-4" />
                                            <span>✅ Agregar Repartidor</span>
                                        </button>
                                        <span className="text-sm text-gray-500">* Campos obligatorios</span>
                                    </div>
                                </div>

                                {/* Lista de repartidores */}
                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100">
                                    <div className="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100">
                                        <div className="flex justify-between items-center">
                                            <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                                <Users className="w-5 h-5 mr-2 text-green-600" />
                                                👥 Equipo de Repartidores ({deliveryPersons.length})
                                            </h3>
                                            <div className="flex items-center space-x-4 text-sm">
                                                <span className="text-green-600 font-medium">🟢 {deliveryPersons.filter(p => p.isTracking).length} Con GPS</span>
                                                <span className="text-gray-600 font-medium">⚪ {deliveryPersons.filter(p => !p.isTracking).length} Sin GPS</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="p-6">
                                        {deliveryPersons.length === 0 ? (
                                            <div className="text-center py-12">
                                                <Users className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                                <p className="text-gray-500 text-lg mb-4">👥 No hay repartidores registrados</p>
                                                <p className="text-sm text-gray-400">Agrega tu primer repartidor usando el formulario de arriba</p>
                                            </div>
                                        ) : (
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                {deliveryPersons.map(person => (
                                                    <div key={person.id} className="border-2 border-gray-200 rounded-lg p-6 hover:shadow-lg transition-all bg-gradient-to-br from-white to-gray-50">
                                                        <div className="flex items-start justify-between mb-4">
                                                            <div className="flex items-center space-x-3">
                                                                <div className="w-12 h-12 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center shadow-lg">
                                                                    <Users className="w-6 h-6 text-white" />
                                                                </div>
                                                                <div>
                                                                    <h4 className="font-bold text-gray-900 text-lg">{person.name}</h4>
                                                                    <p className="text-sm text-gray-600">📞 {person.phone}</p>
                                                                    <p className="text-sm text-gray-500 capitalize">🚗 {person.vehicle}</p>
                                                                </div>
                                                            </div>
                                                            <div className={`w-4 h-4 rounded-full ${person.isTracking ? 'bg-green-500 pulse' : 'bg-gray-300'}`}></div>
                                                        </div>
                                                        
                                                        <div className="text-sm text-gray-600 mb-4 space-y-1">
                                                            <p className="flex justify-between">
                                                                <span>✅ Entregas:</span>
                                                                <span className="font-bold">{orders.filter(o => o.deliveryPerson === person.name && o.status === 'entregado').length}</span>
                                                            </p>
                                                            <p className="flex justify-between">
                                                                <span>🚚 Activos:</span>
                                                                <span className="font-bold">{orders.filter(o => o.deliveryPerson === person.name && o.status !== 'entregado').length}</span>
                                                            </p>
                                                            {locations[person.id] && (
                                                                <p className="text-green-600 font-medium text-xs">
                                                                    📍 GPS: {new Date(locations[person.id].timestamp).toLocaleTimeString()}
                                                                </p>
                                                            )}
                                                        </div>
                                                        
                                                        <div className="flex flex-wrap gap-2">
                                                            {!person.isTracking ? (
                                                                <button
                                                                    onClick={() => startTracking(person.id)}
                                                                    className="text-xs bg-blue-500 text-white px-3 py-2 rounded-lg font-medium hover:bg-blue-600 transition-colors shadow-sm"
                                                                >
                                                                    🛰️ Activar GPS
                                                                </button>
                                                            ) : (
                                                                <button
                                                                    onClick={() => stopTracking(person.id)}
                                                                    className="text-xs bg-red-500 text-white px-3 py-2 rounded-lg font-medium hover:bg-red-600 transition-colors shadow-sm"
                                                                >
                                                                    ⏹️ Detener GPS
                                                                </button>
                                                            )}
                                                            {locations[person.id] && (
                                                                <a
                                                                    href={`https://maps.google.com/maps?q=${locations[person.id].lat},${locations[person.id].lng}`}
                                                                    target="_blank"
                                                                    rel="noopener noreferrer"
                                                                    className="text-xs bg-green-500 text-white px-3 py-2 rounded-lg font-medium hover:bg-green-600 transition-colors shadow-sm"
                                                                >
                                                                    🗺️ Ver Mapa
                                                                </a>
                                                            )}
                                                            <button
                                                                onClick={() => copyDeliveryPersonUrl(person.id, person.name)}
                                                                className="text-xs bg-purple-500 text-white px-3 py-2 rounded-lg font-medium hover:bg-purple-600 transition-colors shadow-sm"
                                                            >
                                                                📱 URL + WhatsApp
                                                            </button>
                                                            <button
                                                                onClick={() => handleDeleteDeliveryPerson(person.id)}
                                                                className="text-xs bg-red-600 text-white px-3 py-2 rounded-lg font-medium hover:bg-red-700 transition-colors shadow-sm"
                                                            >
                                                                🗑️ Eliminar
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Tracking Tab */}
                        {activeTab === 'tracking' && (
                            <div className="space-y-6 fade-in">
                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                        <Smartphone className="mr-2 text-blue-500" />
                                        🛰️ Centro de Control GPS
                                    </h3>
                                    
                                    {deliveryPersons.length === 0 ? (
                                        <div className="text-center py-12">
                                            <MapPin className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                            <p className="text-gray-500 text-lg mb-4">🛰️ No hay repartidores registrados</p>
                                            <button 
                                                onClick={() => setActiveTab('delivery')}
                                                className="bg-green-600 text-white px-6 py-3 rounded-lg font-medium shadow-lg"
                                            >
                                                👤 Agregar Primer Repartidor
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            {deliveryPersons.map(person => (
                                                <div key={person.id} className="border-2 rounded-lg p-6 bg-gradient-to-br from-gray-50 to-gray-100 shadow-md">
                                                    <div className="flex items-center justify-between mb-4">
                                                        <div className="flex items-center space-x-2">
                                                            <div className="w-8 h-8 bg-gradient-to-r from-blue-500 to-green-500 rounded-full flex items-center justify-center">
                                                                <Users className="w-4 h-4 text-white" />
                                                            </div>
                                                            <span className="font-bold text-gray-900">{person.name}</span>
                                                        </div>
                                                        <div className={`w-4 h-4 rounded-full ${person.isTracking ? 'bg-green-500 pulse' : 'bg-red-500'}`}></div>
                                                    </div>
                                                    
                                                    {locations[person.id] ? (
                                                        <div className="text-sm text-gray-600 mb-4 space-y-1">
                                                            <p>📍 Lat: {locations[person.id].lat.toFixed(6)}</p>
                                                            <p>📍 Lng: {locations[person.id].lng.toFixed(6)}</p>
                                                            <p>⏰ {new Date(locations[person.id].timestamp).toLocaleString()}</p>
                                                            <p>🎯 Precisión: ±{Math.round(locations[person.id].accuracy)}m</p>
                                                        </div>
                                                    ) : (
                                                        <p className="text-sm text-gray-500 mb-4">❌ Sin datos GPS</p>
                                                    )}
                                                    
                                                    <div className="flex space-x-2">
                                                        {!person.isTracking ? (
                                                            <button
                                                                onClick={() => startTracking(person.id)}
                                                                className="flex-1 bg-blue-500 text-white text-xs px-3 py-2 rounded-lg font-medium hover:bg-blue-600 transition-colors shadow-sm"
                                                            >
                                                                🛰️ Activar GPS
                                                            </button>
                                                        ) : (
                                                            <button
                                                                onClick={() => stopTracking(person.id)}
                                                                className="flex-1 bg-red-500 text-white text-xs px-3 py-2 rounded-lg font-medium hover:bg-red-600 transition-colors shadow-sm"
                                                            >
                                                                ⏹️ Detener GPS
                                                            </button>
                                                        )}
                                                        
                                                        {locations[person.id] && (
                                                            <a
                                                                href={`https://maps.google.com/maps?q=${locations[person.id].lat},${locations[person.id].lng}`}
                                                                target="_blank"
                                                                rel="noopener noreferrer"
                                                                className="bg-green-500 text-white text-xs px-3 py-2 rounded-lg font-medium hover:bg-green-600 transition-colors shadow-sm"
                                                            >
                                                                🗺️
                                                            </a>
                                                        )}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>

                                {/* Instrucciones para servidor web */}
                                <div className="bg-gradient-to-r from-orange-50 to-red-50 border-2 border-orange-200 rounded-xl p-6 shadow-lg">
                                    <h4 className="font-semibold text-orange-900 mb-4 flex items-center text-lg">
                                        🌐 ¿Archivo Local? ¡Sube a Internet!
                                    </h4>
                                    <div className="text-sm text-orange-800 space-y-3">
                                        <p><strong>💡 IMPORTANTE:</strong> Para que los repartidores accedan desde sus celulares, necesitas subir este archivo a un servidor web.</p>
                                        <div className="bg-white p-4 rounded-lg border border-orange-200">
                                            <p className="font-semibold mb-2">🚀 OPCIONES GRATUITAS:</p>
                                            <div className="space-y-2 text-xs">
                                                <p>• <strong>GitHub Pages:</strong> github.com → Crear repo → Subir como "index.html"</p>
                                                <p>• <strong>Netlify:</strong> app.netlify.com/drop → Arrastrar archivo</p>
                                                <p>• <strong>Vercel:</strong> vercel.com → New Project → Upload</p>
                                            </div>
                                        </div>
                                        <button 
                                            onClick={() => showServerInstructions()}
                                            className="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg font-medium text-sm"
                                        >
                                            📋 Ver Instrucciones Completas
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Analytics Tab */}
                        {activeTab === 'analytics' && (
                            <div className="space-y-6 fade-in">
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* Análisis de rendimiento */}
                                    <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                            <TrendingUp className="mr-2 text-blue-500" />
                                            📊 Análisis de Rendimiento
                                        </h3>
                                        <div className="space-y-4">
                                            <div className="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                                <span className="text-gray-700 font-medium">✅ Pedidos completados</span>
                                                <span className="font-bold text-green-600 text-lg">{metrics.completedOrders}</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                                <span className="text-gray-700 font-medium">📈 Tasa de éxito</span>
                                                <span className="font-bold text-blue-600 text-lg">{metrics.completionRate.toFixed(1)}%</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-orange-50 rounded-lg">
                                                <span className="text-gray-700 font-medium">⏱️ Tiempo promedio</span>
                                                <span className="font-bold text-orange-600 text-lg">{metrics.avgDeliveryTime} min</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                                                <span className="text-gray-700 font-medium">⭐ Calificación promedio</span>
                                                <span className="font-bold text-purple-600 text-lg">{metrics.avgRating.toFixed(1)}/5</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Alertas y recomendaciones */}
                                    <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                            <AlertCircle className="mr-2 text-yellow-500" />
                                            ⚠️ Alertas y Recomendaciones
                                        </h3>
                                        <div className="space-y-3">
                                            {metrics.avgDeliveryTime > 45 && (
                                                <div className="flex items-center space-x-3 p-4 bg-red-50 rounded-lg border border-red-200">
                                                    <AlertCircle className="text-red-500 flex-shrink-0" />
                                                    <span className="text-sm text-red-700 font-medium">🚨 Tiempo de entrega muy alto - optimizar rutas</span>
                                                </div>
                                            )}
                                            {metrics.avgRating > 0 && metrics.avgRating < 4 && (
                                                <div className="flex items-center space-x-3 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                                    <AlertCircle className="text-yellow-500 flex-shrink-0" />
                                                    <span className="text-sm text-yellow-700 font-medium">⭐ Calificación baja - revisar calidad del servicio</span>
                                                </div>
                                            )}
                                            {metrics.completionRate > 0 && metrics.completionRate < 90 && (
                                                <div className="flex items-center space-x-3 p-4 bg-orange-50 rounded-lg border border-orange-200">
                                                    <AlertCircle className="text-orange-500 flex-shrink-0" />
                                                    <span className="text-sm text-orange-700 font-medium">📉 Tasa de completación baja - revisar procesos</span>
                                                </div>
                                            )}
                                            {deliveryPersons.length < 3 && (
                                                <div className="flex items-center space-x-3 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                                    <AlertCircle className="text-blue-500 flex-shrink-0" />
                                                    <span className="text-sm text-blue-700 font-medium">👥 Considerar contratar más repartidores</span>
                                                </div>
                                            )}
                                            {orders.length === 0 && deliveryPersons.length === 0 && (
                                                <div className="flex items-center space-x-3 p-4 bg-green-50 rounded-lg border border-green-200">
                                                    <AlertCircle className="text-green-500 flex-shrink-0" />
                                                    <span className="text-sm text-green-700 font-medium">🚀 ¡Sistema listo! Comienza agregando repartidores y pedidos</span>
                                                </div>
                                            )}
                                            {metrics.totalOrders > 0 && metrics.avgDeliveryTime > 0 && metrics.avgRating >= 4 && metrics.completionRate >= 90 && (
                                                <div className="flex items-center space-x-3 p-4 bg-green-50 rounded-lg border border-green-200">
                                                    <Star className="text-green-500 flex-shrink-0" />
                                                    <span className="text-sm text-green-700 font-medium">🎉 ¡Excelente rendimiento! Todo funcionando perfectamente</span>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* Rendimiento por repartidor */}
                                {deliveryPersons.length > 0 && (
                                    <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100">
                                        <div className="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100">
                                            <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                                <Users className="mr-2 text-green-500" />
                                                👤 Rendimiento Individual
                                            </h3>
                                        </div>
                                        <div className="overflow-x-auto">
                                            <table className="min-w-full">
                                                <thead className="bg-gray-50">
                                                    <tr>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Repartidor</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Entregas</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tiempo Prom.</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Calificación</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado GPS</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="bg-white divide-y divide-gray-200">
                                                    {deliveryPersons.map(person => {
                                                        const personOrders = orders.filter(o => o.deliveryPerson === person.name);
                                                        const completedOrders = personOrders.filter(o => o.status === 'entregado');
                                                        const avgTime = completedOrders.length > 0 
                                                            ? completedOrders.reduce((sum, o) => sum + (parseInt(o.actualDeliveryTime) || 0), 0) / completedOrders.length 
                                                            : 0;
                                                        const avgRating = completedOrders.filter(o => o.rating).length > 0
                                                            ? completedOrders.filter(o => o.rating).reduce((sum, o) => sum + parseInt(o.rating), 0) / completedOrders.filter(o => o.rating).length
                                                            : 0;

                                                        return (
                                                            <tr key={person.id} className="hover:bg-gray-50 transition-colors">
                                                                <td className="px-6 py-4 whitespace-nowrap">
                                                                    <div className="flex items-center space-x-2">
                                                                        <div className="w-8 h-8 bg-gradient-to-r from-blue-500 to-green-500 rounded-full flex items-center justify-center">
                                                                            <Users className="w-4 h-4 text-white" />
                                                                        </div>
                                                                        <span className="text-sm font-medium text-gray-900">{person.name}</span>
                                                                    </div>
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                                    <span className="font-bold text-lg">{completedOrders.length}</span>
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                                    {avgTime > 0 ? (
                                                                        <span className={`font-bold ${avgTime > 45 ? 'text-red-600' : avgTime > 30 ? 'text-yellow-600' : 'text-green-600'}`}>
                                                                            ⏱️ {avgTime.toFixed(0)} min
                                                                        </span>
                                                                    ) : (
                                                                        <span className="text-gray-400">-</span>
                                                                    )}
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                                    {avgRating > 0 ? (
                                                                        <span className={`font-bold ${avgRating >= 4.5 ? 'text-green-600' : avgRating >= 4 ? 'text-yellow-600' : 'text-red-600'}`}>
                                                                            ⭐ {avgRating.toFixed(1)}/5
                                                                        </span>
                                                                    ) : (
                                                                        <span className="text-gray-400">-</span>
                                                                    )}
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                                    <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                                                                        person.isTracking 
                                                                            ? 'bg-green-100 text-green-800' 
                                                                            : 'bg-gray-100 text-gray-800'
                                                                    }`}>
                                                                        <div className={`w-2 h-2 rounded-full mr-1 ${
                                                                            person.isTracking ? 'bg-green-500 pulse' : 'bg-gray-400'
                                                                        }`}></div>
                                                                        {person.isTracking ? '🛰️ Activo' : '📍 Inactivo'}
                                                                    </span>
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 🚀 Renderizar la aplicación
        ReactDOM.render(<DeliverySystem />, document.getElementById('root'));
    </script>
</body>
</html>-to-r from-yellow-50 to-yellow-100 border-2 border-yellow-200 rounded-xl p-6 text-center shadow-lg">
                                        <div className="text-4xl font-bold text-yellow-600 mb-2">{metrics.pendingOrders}</div>
                                        <div className="text-sm font-medium text-yellow-800">📦 Pedidos Pendientes</div>
                                        {metrics.pendingOrders > 0 && <div className="text-xs text-yellow-600 mt-1">Requieren atención</div>}
                                    </div>
                                    <div className="bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-xl p-6 text-center shadow-lg">
                                        <div className="text-4xl font-bold text-blue-600 mb-2">{metrics.activeOrders}</div>
                                        <div className="text-sm font-medium text-blue-800">🚚 En Tránsito</div>
                                        {metrics.activeOrders > 0 && <div className="text-xs text-blue-600 mt-1 pulse">En proceso de entrega</div>}
                                    </div>
                                    <div className="bg-gradient