<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Domicilios - Sistema Profesional</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
            margin: 0; padding: 0; background-color: #f8fafc; line-height: 1.6;
        }
        .loading { 
            display: flex; justify-content: center; align-items: center; height: 100vh; 
            font-size: 18px; color: #6B7280; flex-direction: column; 
        }
        .spinner { 
            border: 3px solid #f3f4f6; border-top: 3px solid #3b82f6; border-radius: 50%; 
            width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 16px; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .metric-card { 
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; 
            cursor: pointer;
        }
        .metric-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); }
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            transition: all 0.3s ease; border: none; outline: none;
        }
        .btn-primary:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); 
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .notification { 
            position: fixed; top: 20px; right: 20px; z-index: 1000; 
            background: #10B981; color: white; padding: 12px 16px; 
            border-radius: 8px; font-size: 14px; font-weight: 500;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
            <p>Iniciando Sistema de Control de Domicilios...</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Configurar Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAR79k-vcBkosnierK1igpFvm20j_6Uyaw",
            authDomain: "domi-67785.firebaseapp.com",
            projectId: "domi-67785",
            storageBucket: "domi-67785.firebasestorage.app",
            messagingSenderId: "334983627289",
            appId: "1:334983627289:web:7dc0737c07f93aa1a76088",
            measurementId: "G-D4YBMXXSRX"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // SVG Icons
        const Icon = ({ d, className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                {Array.isArray(d) ? d.map((path, i) => <path key={i} d={path} />) : <path d={d} />}
            </svg>
        );

        const icons = {
            plus: "M12 5v14m7-7H5",
            trending: "M13 7h8m0 0v8m0-8l-8 8-4-4-6 6",
            package: "M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4M4 7l8 4M4 7v10l8 4m0-10v10",
            users: "M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2m18 0-3-3m-8-8a4 4 0 1 1-8 0 4 4 0 0 1 8 0",
            star: "M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2",
            clock: "M12 6v6l4 2m6-2a10 10 0 1 1-20 0 10 10 0 0 1 20 0",
            dollar: "M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",
            smartphone: "M5 2h14a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m7 16h.01",
            edit: "M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7m-9.5-9.5L21 3l-9.5 9.5-4 1 1-4Z",
            trash: "M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",
            send: "M22 2L11 13m11-11L15 22l-4-9-9-4 20-9",
            alert: "M12 8v4m0 4h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0"
        };

        const Notification = ({ message, type = 'success', onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };

            return <div className={`notification ${colors[type]}`}>{message}</div>;
        };

        const DeliverySystem = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [orders, setOrders] = useState([]);
            const [deliveryPersons, setDeliveryPersons] = useState([]);
            const [locations, setLocations] = useState({});
            const [loading, setLoading] = useState(true);
            const [notifications, setNotifications] = useState([]);
            const [isDeliveryPersonView, setIsDeliveryPersonView] = useState(false);
            const [currentDeliveryPerson, setCurrentDeliveryPerson] = useState(null);
            const [isTrackingLocation, setIsTrackingLocation] = useState(false);

            const [newOrder, setNewOrder] = useState({
                customerName: '', address: '', orderValue: '', deliveryFee: '', 
                deliveryPerson: '', city: '', customerPhone: ''
            });

            const [newDeliveryPerson, setNewDeliveryPerson] = useState({
                name: '', phone: '+57 ', vehicle: 'moto'
            });

            const colombianCities = [
                'Bogotá', 'Medellín', 'Cali', 'Barranquilla', 'Cartagena',
                'Cúcuta', 'Bucaramanga', 'Pereira', 'Santa Marta', 'Ibagué'
            ];

            const showNotification = useCallback((message, type = 'success') => {
                const id = Date.now();
                setNotifications(prev => [...prev, { id, message, type }]);
            }, []);

            // Cargar datos desde Firebase
            useEffect(() => {
                const loadData = async () => {
                    try {
                        console.log('=== CARGANDO DESDE FIREBASE ===');
                        
                        // Cargar pedidos
                        const ordersSnapshot = await db.collection('orders').get();
                        const ordersData = ordersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setOrders(ordersData);
                        console.log('Pedidos cargados:', ordersData.length);

                        // Cargar repartidores
                        const personsSnapshot = await db.collection('deliveryPersons').get();
                        const personsData = personsSnapshot.docs.map(doc => ({ 
                            id: doc.id, 
                            ...doc.data(),
                            // Convertir el ID string de Firestore a número para compatibilidad
                            numericId: doc.data().numericId || doc.id
                        }));
                        setDeliveryPersons(personsData);
                        console.log('Repartidores cargados:', personsData);

                        // Cargar ubicaciones
                        const locationsSnapshot = await db.collection('locations').get();
                        const locationsData = {};
                        locationsSnapshot.docs.forEach(doc => {
                            locationsData[doc.id] = doc.data();
                        });
                        setLocations(locationsData);

                        // Verificar parámetro de URL
                        const urlParams = new URLSearchParams(window.location.search);
                        const deliveryPersonId = urlParams.get('repartidor');
                        
                        console.log('Parámetro repartidor:', deliveryPersonId);

                        if (deliveryPersonId) {
                            // Buscar por numericId
                            const person = personsData.find(p => p.numericId === deliveryPersonId);
                            
                            console.log('Repartidor encontrado:', person);
                            
                            if (person) {
                                setIsDeliveryPersonView(true);
                                setCurrentDeliveryPerson(person);
                                setTimeout(() => {
                                    showNotification(`Bienvenido ${person.name}`, 'success');
                                    setLoading(false);
                                }, 1000);
                            } else {
                                console.error('REPARTIDOR NO ENCONTRADO');
                                console.log('IDs disponibles:', personsData.map(p => p.numericId));
                                setTimeout(() => {
                                    showNotification('Repartidor no encontrado', 'error');
                                    setLoading(false);
                                }, 1000);
                            }
                        } else {
                            setTimeout(() => {
                                showNotification('Sistema cargado correctamente', 'success');
                                setLoading(false);
                            }, 1000);
                        }
                    } catch (error) {
                        console.error('ERROR CARGANDO DATOS:', error);
                        showNotification('Error cargando datos: ' + error.message, 'error');
                        setLoading(false);
                    }
                };

                loadData();
            }, [showNotification]);

            // Listeners en tiempo real para pedidos
            useEffect(() => {
                const unsubscribe = db.collection('orders').onSnapshot(snapshot => {
                    const ordersData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setOrders(ordersData);
                }, error => {
                    console.error('Error en listener de pedidos:', error);
                });

                return () => unsubscribe();
            }, []);

            // Listeners en tiempo real para repartidores
            useEffect(() => {
                const unsubscribe = db.collection('deliveryPersons').onSnapshot(snapshot => {
                    const personsData = snapshot.docs.map(doc => ({ 
                        id: doc.id, 
                        ...doc.data(),
                        numericId: doc.data().numericId || doc.id
                    }));
                    setDeliveryPersons(personsData);
                }, error => {
                    console.error('Error en listener de repartidores:', error);
                });

                return () => unsubscribe();
            }, []);

            // Listeners en tiempo real para ubicaciones
            useEffect(() => {
                const unsubscribe = db.collection('locations').onSnapshot(snapshot => {
                    const locationsData = {};
                    snapshot.docs.forEach(doc => {
                        locationsData[doc.id] = doc.data();
                    });
                    setLocations(locationsData);
                }, error => {
                    console.error('Error en listener de ubicaciones:', error);
                });

                return () => unsubscribe();
            }, []);

            const formatNumber = (num) => {
                if (!num) return '0';
                return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            };

            const calculateMetrics = useCallback(() => {
                if (orders.length === 0) return {
                    totalOrders: 0, totalRevenue: 0, avgDeliveryTime: 0, avgOrderValue: 0,
                    completionRate: 0, avgRating: 0, completedOrders: 0, 
                    activeOrders: 0, pendingOrders: 0
                };

                const completedOrders = orders.filter(o => o.status === 'entregado');
                const activeOrders = orders.filter(o => o.status === 'en_transito');
                const pendingOrders = orders.filter(o => o.status === 'pendiente');
                
                const totalRevenue = orders.reduce((sum, o) => sum + parseFloat(o.orderValue || 0) + parseFloat(o.deliveryFee || 0), 0);
                
                const deliveryTimes = completedOrders.filter(o => o.actualDeliveryTime).map(o => parseInt(o.actualDeliveryTime));
                const avgDeliveryTime = deliveryTimes.length > 0 ? deliveryTimes.reduce((sum, t) => sum + t, 0) / deliveryTimes.length : 0;

                const ratings = completedOrders.filter(o => o.rating).map(o => parseInt(o.rating));
                const avgRating = ratings.length > 0 ? ratings.reduce((sum, r) => sum + r, 0) / ratings.length : 0;

                return {
                    totalOrders: orders.length,
                    completedOrders: completedOrders.length,
                    activeOrders: activeOrders.length,
                    pendingOrders: pendingOrders.length,
                    totalRevenue,
                    avgDeliveryTime: Math.round(avgDeliveryTime),
                    avgOrderValue: totalRevenue / orders.length,
                    completionRate: (completedOrders.length / orders.length) * 100,
                    avgRating
                };
            }, [orders]);

            const handleAddOrder = useCallback(async () => {
                if (!newOrder.customerName?.trim() || !newOrder.address?.trim() || !newOrder.orderValue) {
                    showNotification('Completa los campos obligatorios', 'warning');
                    return;
                }

                try {
                    const order = {
                        ...newOrder,
                        customerName: newOrder.customerName.trim(),
                        address: newOrder.address.trim(),
                        orderValue: parseFloat(newOrder.orderValue),
                        deliveryFee: parseFloat(newOrder.deliveryFee || 0),
                        status: 'pendiente',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };

                    await db.collection('orders').add(order);
                    
                    setNewOrder({
                        customerName: '', address: '', orderValue: '', deliveryFee: '', 
                        deliveryPerson: '', city: '', customerPhone: ''
                    });
                    
                    showNotification(`Pedido creado para ${order.customerName}`, 'success');
                } catch (error) {
                    console.error('Error creando pedido:', error);
                    showNotification('Error creando pedido', 'error');
                }
            }, [newOrder, showNotification]);

            const handleAddDeliveryPerson = useCallback(async () => {
                if (!newDeliveryPerson.name?.trim()) {
                    showNotification('Ingresa el nombre del repartidor', 'warning');
                    return;
                }

                try {
                    const numericId = Date.now().toString();
                    const person = {
                        ...newDeliveryPerson,
                        name: newDeliveryPerson.name.trim(),
                        numericId: numericId,
                        createdAt: new Date().toISOString(),
                        totalDeliveries: 0
                    };

                    await db.collection('deliveryPersons').add(person);
                    
                    setNewDeliveryPerson({ name: '', phone: '+57 ', vehicle: 'moto' });
                    showNotification(`Repartidor ${person.name} agregado`, 'success');
                } catch (error) {
                    console.error('Error agregando repartidor:', error);
                    showNotification('Error agregando repartidor', 'error');
                }
            }, [newDeliveryPerson, showNotification]);

            const handleDeleteDeliveryPerson = useCallback(async (personId) => {
                const person = deliveryPersons.find(p => p.id === personId);
                if (!person) return;

                const hasActiveOrders = orders.some(o => 
                    o.deliveryPerson === person.name && (o.status === 'pendiente' || o.status === 'en_transito')
                );

                if (hasActiveOrders) {
                    showNotification('No se puede eliminar: tiene pedidos activos', 'error');
                    return;
                }

                if (confirm(`¿Eliminar a ${person.name}? Esta acción no se puede deshacer.`)) {
                    try {
                        await db.collection('deliveryPersons').doc(personId).delete();
                        showNotification(`Repartidor ${person.name} eliminado`, 'info');
                    } catch (error) {
                        console.error('Error eliminando repartidor:', error);
                        showNotification('Error eliminando repartidor', 'error');
                    }
                }
            }, [deliveryPersons, orders, showNotification]);

            const handleEditDeliveryPerson = useCallback(async (personId) => {
                const person = deliveryPersons.find(p => p.id === personId);
                if (!person) return;

                const newName = prompt('Nuevo nombre:', person.name);
                const newPhone = prompt('Nuevo teléfono:', person.phone);

                if (newName && newName.trim()) {
                    try {
                        await db.collection('deliveryPersons').doc(personId).update({
                            name: newName.trim(),
                            phone: newPhone || person.phone
                        });
                        showNotification('Repartidor actualizado correctamente', 'success');
                    } catch (error) {
                        console.error('Error actualizando repartidor:', error);
                        showNotification('Error actualizando repartidor', 'error');
                    }
                }
            }, [deliveryPersons, showNotification]);

            const sendWhatsAppInvitation = useCallback((person) => {
                const baseUrl = window.location.origin + window.location.pathname;
                const personalUrl = `${baseUrl}?repartidor=${person.numericId}`;
                
                const message = encodeURIComponent(
                    `Hola ${person.name}\n\n` +
                    `Has sido registrado como repartidor en nuestro sistema de domicilios.\n\n` +
                    `TU ENLACE PERSONAL:\n${personalUrl}\n\n` +
                    `INSTRUCCIONES:\n` +
                    `1. Abre el enlace en tu celular\n` +
                    `2. Autoriza el acceso a tu ubicación GPS\n` +
                    `3. Acepta pedidos desde tu panel\n` +
                    `4. Contacta clientes por WhatsApp\n` +
                    `5. Marca entregas como completadas\n\n` +
                    `Guarda este enlace en tus favoritos`
                );

                const cleanPhone = person.phone.replace(/\D/g, '');
                const phoneNumber = cleanPhone.length >= 10 ? cleanPhone.slice(-10) : null;

                if (phoneNumber) {
                    window.open(`https://wa.me/57${phoneNumber}?text=${message}`, '_blank');
                    showNotification('Invitación enviada por WhatsApp', 'success');
                } else {
                    showNotification('Número de teléfono inválido', 'error');
                }
            }, [showNotification]);

            const updateOrderStatus = useCallback(async (orderId, newStatus) => {
                try {
                    await db.collection('orders').doc(orderId).update({
                        status: newStatus,
                        updatedAt: new Date().toISOString()
                    });

                    const messages = {
                        'en_transito': 'Pedido enviado',
                        'entregado': 'Pedido completado'
                    };
                    
                    if (messages[newStatus]) showNotification(messages[newStatus], 'success');
                } catch (error) {
                    console.error('Error actualizando estado:', error);
                    showNotification('Error actualizando pedido', 'error');
                }
            }, [showNotification]);

            const completeDelivery = useCallback(async (orderId, deliveryTime, rating) => {
                try {
                    await db.collection('orders').doc(orderId).update({
                        status: 'entregado',
                        actualDeliveryTime: deliveryTime,
                        rating: rating,
                        completedAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                    
                    showNotification('Entrega completada exitosamente', 'success');
                } catch (error) {
                    console.error('Error completando entrega:', error);
                    showNotification('Error completando entrega', 'error');
                }
            }, [showNotification]);

            const startLocationTracking = useCallback(() => {
                if (!navigator.geolocation) {
                    showNotification('Tu dispositivo no soporta geolocalización', 'error');
                    return;
                }

                setIsTrackingLocation(true);
                showNotification('Rastreo GPS activado', 'info');

                const watchId = navigator.geolocation.watchPosition(
                    async (position) => {
                        const newLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            timestamp: new Date().toISOString()
                        };
                        
                        if (currentDeliveryPerson) {
                            try {
                                await db.collection('locations').doc(currentDeliveryPerson.id).set(newLocation);
                            } catch (error) {
                                console.error('Error guardando ubicación:', error);
                            }
                        }
                    },
                    (error) => {
                        console.error('Error obteniendo ubicación:', error);
                        showNotification('Error obteniendo ubicación GPS', 'error');
                    },
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                );

                return () => navigator.geolocation.clearWatch(watchId);
            }, [currentDeliveryPerson, showNotification]);

            const stopLocationTracking = useCallback(() => {
                setIsTrackingLocation(false);
                showNotification('Rastreo GPS desactivado', 'info');
            }, [showNotification]);

            const acceptOrder = useCallback((orderId) => {
                if (!currentDeliveryPerson) return;
                
                updateOrderStatus(orderId, 'en_transito');
                showNotification('Pedido aceptado', 'success');
                
                if (!isTrackingLocation) startLocationTracking();
            }, [currentDeliveryPerson, isTrackingLocation, startLocationTracking, updateOrderStatus, showNotification]);

            const contactCustomer = useCallback((phone) => {
                const cleanPhone = phone.replace(/\D/g, '');
                const phoneNumber = cleanPhone.length >= 10 ? cleanPhone.slice(-10) : null;

                if (phoneNumber) {
                    window.open(`https://wa.me/57${phoneNumber}`, '_blank');
                } else {
                    showNotification('Número de teléfono no disponible', 'error');
                }
            }, [showNotification]);

            const metrics = calculateMetrics();

            const MetricCard = ({ title, value, icon, color, prefix = "", suffix = "" }) => (
                <div className="metric-card bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100 hover:border-gray-200 fade-in">
                    <div className="flex items-center justify-between">
                        <div className="flex-1">
                            <p className="text-sm font-medium text-gray-600 mb-1">{title}</p>
                            <p className="text-2xl font-bold text-gray-900 mb-1">
                                {prefix}{typeof value === 'number' ? formatNumber(value) : value}{suffix}
                            </p>
                        </div>
                        <div className="ml-4 flex-shrink-0">
                            <div 
                                className="w-12 h-12 rounded-xl flex items-center justify-center shadow-md"
                                style={{ backgroundColor: color + '15' }}
                            >
                                <Icon d={icon} className="w-6 h-6" style={{ color }} />
                            </div>
                        </div>
                    </div>
                </div>
            );

            const tabs = [
                { id: 'dashboard', name: 'Dashboard', icon: icons.trending },
                { id: 'orders', name: 'Pedidos', icon: icons.package },
                { id: 'delivery', name: 'Repartidores', icon: icons.users },
                { id: 'analytics', name: 'Análisis', icon: icons.star }
            ];

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <p>Iniciando Sistema de Control de Domicilios...</p>
                    </div>
                );
            }

            if (isDeliveryPersonView && currentDeliveryPerson) {
                const myOrders = orders.filter(o => o.deliveryPerson === currentDeliveryPerson.name);
                const pendingOrders = myOrders.filter(o => o.status === 'pendiente');
                const activeOrders = myOrders.filter(o => o.status === 'en_transito');
                const completedOrders = myOrders.filter(o => o.status === 'entregado');

                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-50 via-blue-50 to-purple-50">
                        {notifications.map(n => (
                            <Notification
                                key={n.id}
                                message={n.message}
                                type={n.type}
                                onClose={() => setNotifications(prev => prev.filter(item => item.id !== n.id))}
                            />
                        ))}

                        <div className="bg-gradient-to-r from-green-600 to-blue-600 text-white shadow-lg">
                            <div className="max-w-4xl mx-auto px-4 py-6">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h1 className="text-2xl font-bold">Hola, {currentDeliveryPerson.name}</h1>
                                        <p className="text-green-100 text-sm">Panel de Repartidor</p>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-sm text-green-100">GPS</div>
                                        <button
                                            onClick={isTrackingLocation ? stopLocationTracking : startLocationTracking}
                                            className={`px-4 py-2 rounded-lg font-medium text-sm ${
                                                isTrackingLocation 
                                                    ? 'bg-red-500 hover:bg-red-600' 
                                                    : 'bg-white text-green-600 hover:bg-green-50'
                                            }`}
                                        >
                                            {isTrackingLocation ? 'Detener' : 'Activar'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="max-w-4xl mx-auto px-4 py-6 space-y-6">
                            <div className="grid grid-cols-3 gap-4">
                                <div className="bg-white rounded-xl p-4 shadow-lg border-2 border-yellow-200">
                                    <div className="text-2xl font-bold text-yellow-600">{pendingOrders.length}</div>
                                    <div className="text-sm text-gray-600">Pendientes</div>
                                </div>
                                <div className="bg-white rounded-xl p-4 shadow-lg border-2 border-blue-200">
                                    <div className="text-2xl font-bold text-blue-600">{activeOrders.length}</div>
                                    <div className="text-sm text-gray-600">En Ruta</div>
                                </div>
                                <div className="bg-white rounded-xl p-4 shadow-lg border-2 border-green-200">
                                    <div className="text-2xl font-bold text-green-600">{completedOrders.length}</div>
                                    <div className="text-sm text-gray-600">Completadas</div>
                                </div>
                            </div>

                            {pendingOrders.length > 0 && (
                                <div className="bg-white rounded-xl shadow-lg border-2 border-yellow-200">
                                    <div className="px-6 py-4 bg-yellow-50 border-b border-yellow-200">
                                        <h3 className="text-lg font-semibold text-gray-900">Pedidos Disponibles</h3>
                                    </div>
                                    <div className="p-4 space-y-4">
                                        {pendingOrders.map(order => (
                                            <div key={order.id} className="bg-yellow-50 rounded-lg p-4 border-2 border-yellow-200">
                                                <div className="flex justify-between items-start mb-3">
                                                    <div>
                                                        <h4 className="font-bold text-gray-900 text-lg">{order.customerName}</h4>
                                                        <p className="text-sm text-gray-600">{order.address}</p>
                                                        {order.city && <p className="text-xs text-gray-500">{order.city}</p>}
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-lg font-bold text-green-600">${formatNumber(order.orderValue)}</div>
                                                        {order.deliveryFee > 0 && (
                                                            <div className="text-sm text-gray-600">+ ${formatNumber(order.deliveryFee)} envío</div>
                                                        )}
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => acceptOrder(order.id)}
                                                        className="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium"
                                                    >
                                                        Aceptar Pedido
                                                    </button>
                                                    {order.customerPhone && (
                                                        <button
                                                            onClick={() => contactCustomer(order.customerPhone)}
                                                            className="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg"
                                                        >
                                                            <Icon d={icons.smartphone} className="w-5 h-5" />
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {activeOrders.length > 0 && (
                                <div className="bg-white rounded-xl shadow-lg border-2 border-blue-200">
                                    <div className="px-6 py-4 bg-blue-50 border-b border-blue-200">
                                        <h3 className="text-lg font-semibold text-gray-900">En Ruta</h3>
                                    </div>
                                    <div className="p-4 space-y-4">
                                        {activeOrders.map(order => (
                                            <div key={order.id} className="bg-blue-50 rounded-lg p-4 border-2 border-blue-200">
                                                <div className="flex justify-between items-start mb-3">
                                                    <div>
                                                        <h4 className="font-bold text-gray-900 text-lg">{order.customerName}</h4>
                                                        <p className="text-sm text-gray-600">{order.address}</p>
                                                        {order.city && <p className="text-xs text-gray-500">{order.city}</p>}
                                                    </div>
                                                    <div className="text-lg font-bold text-green-600">${formatNumber(order.orderValue)}</div>
                                                </div>
                                                
                                                {!isTrackingLocation && (
                                                    <div className="bg-orange-100 border-2 border-orange-300 rounded-lg p-3 mb-3 flex items-start">
                                                        <Icon d={icons.alert} className="w-5 h-5 text-orange-600 mr-2 flex-shrink-0 mt-0.5" />
                                                        <div className="text-sm text-orange-800">
                                                            <strong>GPS desactivado.</strong> Activa el rastreo para que el cliente pueda seguir tu ubicación.
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                <div className="grid grid-cols-2 gap-2">
                                                    {order.customerPhone && (
                                                        <button
                                                            onClick={() => contactCustomer(order.customerPhone)}
                                                            className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium flex items-center justify-center space-x-2"
                                                        >
                                                            <Icon d={icons.smartphone} className="w-4 h-4" />
                                                            <span>Contactar</span>
                                                        </button>
                                                    )}
                                                    <button
                                                        onClick={() => {
                                                            const time = prompt('¿Cuántos minutos tardó la entrega?', '30');
                                                            const rating = prompt('¿Cómo calificarías la entrega? (1-5)', '5');
                                                            if (time && rating) {
                                                                completeDelivery(order.id, time, rating);
                                                            }
                                                        }}
                                                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium"
                                                    >
                                                        Completar
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {completedOrders.length > 0 && (
                                <div className="bg-white rounded-xl shadow-lg border-2 border-green-200">
                                    <div className="px-6 py-4 bg-green-50 border-b border-green-200">
                                        <h3 className="text-lg font-semibold text-gray-900">Historial de Entregas</h3>
                                    </div>
                                    <div className="p-4 space-y-3">
                                        {completedOrders.slice(0, 5).map(order => (
                                            <div key={order.id} className="bg-green-50 rounded-lg p-4 border border-green-200">
                                                <div className="flex justify-between items-start">
                                                    <div>
                                                        <h4 className="font-bold text-gray-900">{order.customerName}</h4>
                                                        <p className="text-sm text-gray-600">{order.address}</p>
                                                        {order.completedAt && (
                                                            <p className="text-xs text-gray-500 mt-1">{new Date(order.completedAt).toLocaleString()}</p>
                                                        )}
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="font-bold text-green-600">${formatNumber(order.orderValue)}</div>
                                                        {order.rating && (
                                                            <div className="text-sm text-yellow-600">{order.rating}/5</div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {myOrders.length === 0 && (
                                <div className="bg-white rounded-xl shadow-lg p-12 text-center">
                                    <Icon d={icons.package} className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                    <h3 className="text-xl font-bold text-gray-900 mb-2">No hay pedidos asignados</h3>
                                    <p className="text-gray-600">Los nuevos pedidos aparecerán aquí cuando te los asignen.</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100">
                    {notifications.map(n => (
                        <Notification
                            key={n.id}
                            message={n.message}
                            type={n.type}
                            onClose={() => setNotifications(prev => prev.filter(item => item.id !== n.id))}
                        />
                    ))}

                    <div className="bg-white shadow-lg border-b-2 border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-6">
                                <div className="flex items-center space-x-4">
                                    <div className="w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                        <Icon d={icons.package} className="w-6 h-6 text-white" />
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-900">Control de Domicilios</h1>
                                        <p className="text-sm text-gray-600">Sistema de gestión profesional v2.0 + Firebase</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white border-b-2 border-gray-100 sticky top-0 z-10 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <nav className="flex space-x-1 py-4">
                                {tabs.map(tab => {
                                    const isActive = activeTab === tab.id;
                                    return (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`flex items-center space-x-2 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-300 ${
                                                isActive 
                                                    ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg transform scale-105' 
                                                    : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                            }`}
                                        >
                                            <Icon d={tab.icon} className="w-4 h-4" />
                                            <span>{tab.name}</span>
                                        </button>
                                    );
                                })}
                            </nav>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {activeTab === 'dashboard' && (
                            <div className="space-y-8 fade-in">
                                <div className="text-center bg-gradient-to-r from-blue-50 via-purple-50 to-pink-50 rounded-2xl p-8 border-2 border-blue-100 shadow-lg">
                                    <h2 className="text-3xl font-bold text-gray-900 mb-3">
                                        Dashboard de Control Profesional
                                    </h2>
                                    <p className="text-gray-600 text-lg max-w-3xl mx-auto">
                                        Gestiona tus domicilios con seguimiento en tiempo real y sincronización en la nube.
                                    </p>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    <MetricCard title="Total Pedidos" value={metrics.totalOrders} icon={icons.package} color="#3B82F6" />
                                    <MetricCard title="Ingresos Totales" value={metrics.totalRevenue} icon={icons.dollar} color="#10B981" prefix="$" />
                                    <MetricCard title="Tiempo Promedio" value={metrics.avgDeliveryTime} icon={icons.clock} color="#F59E0B" suffix=" min" />
                                    <MetricCard title="Calificación" value={metrics.avgRating.toFixed(1)} icon={icons.star} color="#EF4444" suffix="/5" />
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-xl p-6 text-center shadow-lg">
                                        <div className="text-4xl font-bold text-green-600 mb-2">{metrics.completedOrders}</div>
                                        <div className="text-sm font-medium text-green-800">Entregados</div>
                                    </div>
                                    <div className="bg-gradient-to-r from-yellow-50 to-yellow-100 border-2 border-yellow-200 rounded-xl p-6 text-center shadow-lg">
                                        <div className="text-4xl font-bold text-yellow-600 mb-2">{metrics.pendingOrders}</div>
                                        <div className="text-sm font-medium text-yellow-800">Pendientes</div>
                                    </div>
                                    <div className="bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-xl p-6 text-center shadow-lg">
                                        <div className="text-4xl font-bold text-blue-600 mb-2">{metrics.activeOrders}</div>
                                        <div className="text-sm font-medium text-blue-800">En Tránsito</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'orders' && (
                            <div className="space-y-6 fade-in">
                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                        <Icon d={icons.plus} className="w-5 h-5 mr-2 text-blue-600" />
                                        Crear Nuevo Pedido
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Cliente *</label>
                                            <input
                                                type="text"
                                                placeholder="Nombre del cliente"
                                                value={newOrder.customerName}
                                                onChange={(e) => setNewOrder({...newOrder, customerName: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Dirección *</label>
                                            <input
                                                type="text"
                                                placeholder="Dirección de entrega"
                                                value={newOrder.address}
                                                onChange={(e) => setNewOrder({...newOrder, address: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Ciudad</label>
                                            <select
                                                value={newOrder.city}
                                                onChange={(e) => setNewOrder({...newOrder, city: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            >
                                                <option value="">Seleccionar ciudad</option>
                                                {colombianCities.map(city => (
                                                    <option key={city} value={city}>{city}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Valor del pedido *</label>
                                            <input
                                                type="number"
                                                placeholder="Ej: 25000"
                                                value={newOrder.orderValue}
                                                onChange={(e) => setNewOrder({...newOrder, orderValue: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Costo de envío</label>
                                            <input
                                                type="number"
                                                placeholder="Ej: 3000"
                                                value={newOrder.deliveryFee}
                                                onChange={(e) => setNewOrder({...newOrder, deliveryFee: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Teléfono Cliente</label>
                                            <input
                                                type="text"
                                                placeholder="+57 300 123 4567"
                                                value={newOrder.customerPhone}
                                                onChange={(e) => setNewOrder({...newOrder, customerPhone: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Repartidor</label>
                                            <select
                                                value={newOrder.deliveryPerson}
                                                onChange={(e) => setNewOrder({...newOrder, deliveryPerson: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            >
                                                <option value="">Seleccionar repartidor</option>
                                                {deliveryPersons.map(person => (
                                                    <option key={person.id} value={person.name}>{person.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    <div className="mt-6">
                                        <button
                                            onClick={handleAddOrder}
                                            className="btn-primary text-white px-6 py-3 rounded-lg font-medium inline-flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                        >
                                            <Icon d={icons.plus} className="w-4 h-4" />
                                            <span>Crear Pedido</span>
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100">
                                    <div className="px-6 py-4 border-b border-gray-200">
                                        <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                            <Icon d={icons.package} className="w-5 h-5 mr-2 text-blue-600" />
                                            Todos los Pedidos ({orders.length})
                                        </h3>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Dirección</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Repartidor</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {orders.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="6" className="px-6 py-12 text-center">
                                                            <Icon d={icons.package} className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                                            <p className="text-gray-500 text-lg">No hay pedidos registrados</p>
                                                        </td>
                                                    </tr>
                                                ) : (
                                                    orders.map(order => (
                                                        <tr key={order.id} className="hover:bg-gray-50">
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="font-medium text-gray-900">{order.customerName}</div>
                                                                <div className="text-xs text-gray-500">{order.createdAt ? new Date(order.createdAt).toLocaleString() : ''}</div>
                                                            </td>
                                                            <td className="px-6 py-4">
                                                                <div className="text-sm text-gray-900">{order.address}</div>
                                                                {order.city && <div className="text-xs text-gray-500">{order.city}</div>}
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="text-sm text-gray-900">{order.deliveryPerson || 'Sin asignar'}</div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="text-sm font-medium text-gray-900">${formatNumber(order.orderValue)}</div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`inline-flex px-3 py-1 text-xs font-medium rounded-full ${
                                                                    order.status === 'entregado' ? 'bg-green-100 text-green-800' :
                                                                    order.status === 'en_transito' ? 'bg-blue-100 text-blue-800' :
                                                                    'bg-yellow-100 text-yellow-800'
                                                                }`}>
                                                                    {order.status === 'entregado' ? 'Entregado' :
                                                                     order.status === 'en_transito' ? 'En Tránsito' : 
                                                                     'Pendiente'}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                                {order.status === 'pendiente' && (
                                                                    <button
                                                                        onClick={() => updateOrderStatus(order.id, 'en_transito')}
                                                                        className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-medium"
                                                                    >
                                                                        Enviar
                                                                    </button>
                                                                )}
                                                                {order.status === 'en_transito' && (
                                                                    <button
                                                                        onClick={() => {
                                                                            const time = prompt('Tiempo de entrega (minutos):');
                                                                            const rating = prompt('Calificación (1-5):');
                                                                            if (time && rating) {
                                                                                completeDelivery(order.id, time, rating);
                                                                            }
                                                                        }}
                                                                        className="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs font-medium"
                                                                    >
                                                                        Completar
                                                                    </button>
                                                                )}
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'delivery' && (
                            <div className="space-y-6 fade-in">
                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                        <Icon d={icons.users} className="w-5 h-5 mr-2 text-green-600" />
                                        Registrar Nuevo Repartidor
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Nombre *</label>
                                            <input
                                                type="text"
                                                placeholder="Nombre del repartidor"
                                                value={newDeliveryPerson.name}
                                                onChange={(e) => setNewDeliveryPerson({...newDeliveryPerson, name: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                                            <input
                                                type="text"
                                                placeholder="+57 300 123 4567"
                                                value={newDeliveryPerson.phone}
                                                onChange={(e) => setNewDeliveryPerson({...newDeliveryPerson, phone: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Vehículo</label>
                                            <select
                                                value={newDeliveryPerson.vehicle}
                                                onChange={(e) => setNewDeliveryPerson({...newDeliveryPerson, vehicle: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                            >
                                                <option value="moto">Motocicleta</option>
                                                <option value="bicicleta">Bicicleta</option>
                                                <option value="carro">Automóvil</option>
                                                <option value="pie">A pie</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="mt-6">
                                        <button
                                            onClick={handleAddDeliveryPerson}
                                            className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium inline-flex items-center space-x-2 shadow-lg"
                                        >
                                            <Icon d={icons.plus} className="
											<Icon d={icons.plus} className="w-4 h-4" />
                                            <span>Agregar Repartidor</span>
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100">
                                    <div className="px-6 py-4 border-b border-gray-200">
                                        <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                            <Icon d={icons.users} className="w-5 h-5 mr-2 text-green-600" />
                                            Repartidores ({deliveryPersons.length})
                                        </h3>
                                    </div>
                                    <div className="p-6">
                                        {deliveryPersons.length === 0 ? (
                                            <div className="text-center py-12">
                                                <Icon d={icons.users} className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                                <p className="text-gray-500 text-lg">No hay repartidores registrados</p>
                                            </div>
                                        ) : (
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                {deliveryPersons.map(person => (
                                                    <div key={person.id} className="border-2 border-gray-200 rounded-lg p-6 hover:shadow-lg transition-all">
                                                        <div className="flex items-center justify-between mb-4">
                                                            <div className="flex items-center space-x-3">
                                                                <div className="w-12 h-12 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                                                                    <Icon d={icons.users} className="w-6 h-6 text-white" />
                                                                </div>
                                                                <div>
                                                                    <h4 className="font-bold text-gray-900">{person.name}</h4>
                                                                    <p className="text-sm text-gray-600">{person.phone}</p>
                                                                    <p className="text-xs text-gray-500 capitalize">{person.vehicle}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="text-sm text-gray-600 space-y-2 mb-4 p-3 bg-gray-50 rounded-lg">
                                                            <p className="flex justify-between">
                                                                <span>Entregas completadas:</span>
                                                                <span className="font-bold">{orders.filter(o => o.deliveryPerson === person.name && o.status === 'entregado').length}</span>
                                                            </p>
                                                            <p className="flex justify-between">
                                                                <span>Pedidos activos:</span>
                                                                <span className="font-bold">{orders.filter(o => o.deliveryPerson === person.name && o.status !== 'entregado').length}</span>
                                                            </p>
                                                        </div>
                                                        <div className="flex flex-wrap gap-2">
                                                            <button
                                                                onClick={() => sendWhatsAppInvitation(person)}
                                                                className="flex-1 bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-xs font-medium flex items-center justify-center space-x-1 transition-colors"
                                                            >
                                                                <Icon d={icons.send} className="w-3 h-3" />
                                                                <span>Enviar Acceso</span>
                                                            </button>
                                                            <button
                                                                onClick={() => handleEditDeliveryPerson(person.id)}
                                                                className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-xs font-medium flex items-center justify-center transition-colors"
                                                            >
                                                                <Icon d={icons.edit} className="w-3 h-3" />
                                                            </button>
                                                            <button
                                                                onClick={() => handleDeleteDeliveryPerson(person.id)}
                                                                className="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-xs font-medium flex items-center justify-center transition-colors"
                                                            >
                                                                <Icon d={icons.trash} className="w-3 h-3" />
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'analytics' && (
                            <div className="space-y-6 fade-in">
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                            <Icon d={icons.trending} className="w-5 h-5 mr-2 text-blue-500" />
                                            Análisis de Rendimiento
                                        </h3>
                                        <div className="space-y-4">
                                            <div className="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                                <span className="text-gray-700 font-medium">Pedidos completados</span>
                                                <span className="font-bold text-green-600 text-lg">{metrics.completedOrders}</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                                <span className="text-gray-700 font-medium">Tasa de éxito</span>
                                                <span className="font-bold text-blue-600 text-lg">{metrics.completionRate.toFixed(1)}%</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-orange-50 rounded-lg">
                                                <span className="text-gray-700 font-medium">Tiempo promedio</span>
                                                <span className="font-bold text-orange-600 text-lg">{metrics.avgDeliveryTime} min</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<DeliverySystem />, document.getElementById('root'));
    </script>
</body>
</html>