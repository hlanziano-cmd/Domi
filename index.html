<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Domicilios - Sistema Profesional</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
            margin: 0; padding: 0; background-color: #f8fafc; line-height: 1.6;
        }
        .loading { 
            display: flex; justify-content: center; align-items: center; height: 100vh; 
            font-size: 18px; color: #6B7280; flex-direction: column; 
        }
        .spinner { 
            border: 3px solid #f3f4f6; border-top: 3px solid #3b82f6; border-radius: 50%; 
            width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 16px; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .metric-card { 
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; 
            cursor: pointer;
        }
        .metric-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); }
        .btn-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            transition: all 0.3s ease; border: none; outline: none;
        }
        .btn-primary:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); 
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .notification { 
            position: fixed; top: 20px; right: 20px; z-index: 1000; 
            background: #10B981; color: white; padding: 12px 16px; 
            border-radius: 8px; font-size: 14px; font-weight: 500;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .whatsapp-btn { background: #25D366; }
        .whatsapp-btn:hover { background: #22C55E; }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
            <p>üöÄ Iniciando Sistema de Control de Domicilios...</p>
            <small class="text-gray-400">Cargando interfaz profesional</small>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Iconos SVG
        const PlusCircle = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="16"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
        );

        const TrendingUp = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const Package = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="m7.5 4.27 9 5.15"></path>
                <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
                <path d="m3.3 7 8.7 5 8.7-5"></path>
                <path d="M12 22V12"></path>
            </svg>
        );

        const Users = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="m22 21-3-3"></path>
            </svg>
        );

        const MapPin = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const Star = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
            </svg>
        );

        const Clock = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12,6 12,12 16,14"></polyline>
            </svg>
        );

        const DollarSign = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const Navigation = ({ className = "w-3 h-3" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polygon points="3,11 22,2 13,21 11,13 3,11"></polygon>
            </svg>
        );

        const Smartphone = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                <line x1="12" y1="18" x2="12.01" y2="18"></line>
            </svg>
        );

        const Edit = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
        );

        const Trash = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="m19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const Send = ({ className = "w-4 h-4" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const AlertCircle = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        // Componente de Notificaci√≥n
        const Notification = ({ message, type = 'success', onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };

            return (
                <div className={`notification ${colors[type]}`}>
                    {message}
                </div>
            );
        };

        // Componente principal
        const DeliverySystem = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [orders, setOrders] = useState([]);
            const [deliveryPersons, setDeliveryPersons] = useState([]);
            const [locations, setLocations] = useState({});
            const [loading, setLoading] = useState(true);
            const [notifications, setNotifications] = useState([]);

            const [newOrder, setNewOrder] = useState({
                customerName: '', address: '', orderValue: '', deliveryFee: '', 
                deliveryPerson: '', city: '', customerPhone: ''
            });

            const [newDeliveryPerson, setNewDeliveryPerson] = useState({
                name: '', phone: '+57 ', vehicle: 'moto'
            });

            const colombianCities = [
                'Bogot√°', 'Medell√≠n', 'Cali', 'Barranquilla', 'Cartagena',
                'C√∫cuta', 'Bucaramanga', 'Pereira', 'Santa Marta', 'Ibagu√©'
            ];

            const showNotification = useCallback((message, type = 'success') => {
                const id = Date.now();
                setNotifications(prev => [...prev, { id, message, type }]);
            }, []);

            useEffect(() => {
                const loadData = async () => {
                    try {
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        const savedOrders = localStorage.getItem('deliveryOrders_v2');
                        const savedPersons = localStorage.getItem('deliveryPersons_v2');
                        const savedLocations = localStorage.getItem('deliveryLocations_v2');
                        
                        if (savedOrders) setOrders(JSON.parse(savedOrders));
                        if (savedPersons) setDeliveryPersons(JSON.parse(savedPersons));
                        if (savedLocations) setLocations(JSON.parse(savedLocations));

                        showNotification('¬°Sistema cargado correctamente! üöÄ', 'success');
                        setLoading(false);
                    } catch (error) {
                        console.error('Error cargando datos:', error);
                        showNotification('Error cargando datos', 'error');
                        setLoading(false);
                    }
                };
                
                loadData();
            }, [showNotification]);

            useEffect(() => {
                if (!loading) {
                    try {
                        localStorage.setItem('deliveryOrders_v2', JSON.stringify(orders));
                    } catch (error) {
                        console.error('Error guardando pedidos:', error);
                    }
                }
            }, [orders, loading]);

            useEffect(() => {
                if (!loading) {
                    try {
                        localStorage.setItem('deliveryPersons_v2', JSON.stringify(deliveryPersons));
                    } catch (error) {
                        console.error('Error guardando repartidores:', error);
                    }
                }
            }, [deliveryPersons, loading]);

            useEffect(() => {
                if (!loading) {
                    try {
                        localStorage.setItem('deliveryLocations_v2', JSON.stringify(locations));
                    } catch (error) {
                        console.error('Error guardando ubicaciones:', error);
                    }
                }
            }, [locations, loading]);

            const formatNumber = (num) => {
                if (!num) return '0';
                return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            };

            const calculateMetrics = useCallback(() => {
                if (orders.length === 0) return {
                    totalOrders: 0, totalRevenue: 0, avgDeliveryTime: 0, avgOrderValue: 0,
                    completionRate: 0, avgRating: 0, completedOrders: 0, 
                    activeOrders: 0, pendingOrders: 0
                };

                const completedOrders = orders.filter(order => order.status === 'entregado');
                const activeOrders = orders.filter(order => order.status === 'en_transito');
                const pendingOrders = orders.filter(order => order.status === 'pendiente');
                
                const totalRevenue = orders.reduce((sum, order) => 
                    sum + parseFloat(order.orderValue || 0), 0);
                const totalDeliveryFees = orders.reduce((sum, order) => 
                    sum + parseFloat(order.deliveryFee || 0), 0);
                
                const deliveryTimes = completedOrders
                    .filter(order => order.actualDeliveryTime)
                    .map(order => parseInt(order.actualDeliveryTime));
                const avgDeliveryTime = deliveryTimes.length > 0 
                    ? deliveryTimes.reduce((sum, time) => sum + time, 0) / deliveryTimes.length 
                    : 0;

                const ratings = completedOrders
                    .filter(order => order.rating)
                    .map(order => parseInt(order.rating));
                const avgRating = ratings.length > 0 
                    ? ratings.reduce((sum, rating) => sum + rating, 0) / ratings.length 
                    : 0;

                return {
                    totalOrders: orders.length,
                    completedOrders: completedOrders.length,
                    activeOrders: activeOrders.length,
                    pendingOrders: pendingOrders.length,
                    totalRevenue: totalRevenue + totalDeliveryFees,
                    avgDeliveryTime: Math.round(avgDeliveryTime),
                    avgOrderValue: orders.length > 0 ? totalRevenue / orders.length : 0,
                    completionRate: orders.length > 0 ? (completedOrders.length / orders.length) * 100 : 0,
                    avgRating: avgRating
                };
            }, [orders]);

            const handleAddOrder = useCallback(() => {
                if (!newOrder.customerName?.trim() || !newOrder.address?.trim() || !newOrder.orderValue) {
                    showNotification('Completa los campos obligatorios', 'warning');
                    return;
                }

                const order = {
                    id: Date.now(),
                    ...newOrder,
                    customerName: newOrder.customerName.trim(),
                    address: newOrder.address.trim(),
                    orderValue: parseFloat(newOrder.orderValue),
                    deliveryFee: parseFloat(newOrder.deliveryFee || 0),
                    status: 'pendiente',
                    createdAt: new Date().toLocaleString(),
                    updatedAt: new Date().toLocaleString()
                };

                setOrders(prev => [order, ...prev]);
                setNewOrder({
                    customerName: '', address: '', orderValue: '', deliveryFee: '', 
                    deliveryPerson: '', city: '', customerPhone: ''
                });
                
                showNotification(`‚úÖ Pedido creado para ${order.customerName}`, 'success');
            }, [newOrder, showNotification]);

            const handleAddDeliveryPerson = useCallback(() => {
                if (!newDeliveryPerson.name?.trim()) {
                    showNotification('Ingresa el nombre del repartidor', 'warning');
                    return;
                }

                const person = {
                    id: Date.now(),
                    ...newDeliveryPerson,
                    name: newDeliveryPerson.name.trim(),
                    createdAt: new Date().toLocaleString(),
                    isTracking: false,
                    totalDeliveries: 0
                };

                setDeliveryPersons(prev => [person, ...prev]);
                setNewDeliveryPerson({ name: '', phone: '+57 ', vehicle: 'moto' });
                
                showNotification(`Repartidor ${person.name} agregado`, 'success');
            }, [newDeliveryPerson, showNotification]);

            const handleDeleteDeliveryPerson = useCallback((personId) => {
                const person = deliveryPersons.find(p => p.id === personId);
                if (!person) return;

                const hasActiveOrders = orders.some(order => 
                    order.deliveryPerson === person.name && 
                    (order.status === 'pendiente' || order.status === 'en_transito')
                );

                if (hasActiveOrders) {
                    showNotification('No se puede eliminar: tiene pedidos activos', 'error');
                    return;
                }

                if (confirm(`¬øEliminar a ${person.name}? Esta acci√≥n no se puede deshacer.`)) {
                    setDeliveryPersons(prev => prev.filter(p => p.id !== personId));
                    showNotification(`Repartidor ${person.name} eliminado`, 'info');
                }
            }, [deliveryPersons, orders, showNotification]);

            const handleEditDeliveryPerson = useCallback((personId) => {
                const person = deliveryPersons.find(p => p.id === personId);
                if (!person) return;

                const newName = prompt('Nuevo nombre:', person.name);
                const newPhone = prompt('Nuevo tel√©fono:', person.phone);

                if (newName && newName.trim()) {
                    setDeliveryPersons(prev => prev.map(p => 
                        p.id === personId 
                            ? { ...p, name: newName.trim(), phone: newPhone || p.phone }
                            : p
                    ));
                    showNotification('Repartidor actualizado correctamente', 'success');
                }
            }, [deliveryPersons, showNotification]);

            const sendWhatsAppInvitation = useCallback((person) => {
                const baseUrl = window.location.origin + window.location.pathname;
                const personalUrl = `${baseUrl}?repartidor=${person.id}`;
                
                const message = encodeURIComponent(
                    `¬°Hola ${person.name}! üëã\n\n` +
                    `Has sido registrado como repartidor en nuestro sistema de domicilios.\n\n` +
                    `üì± TU ENLACE PERSONAL:\n${personalUrl}\n\n` +
                    `üîê INSTRUCCIONES DE ACCESO:\n\n` +
                    `1Ô∏è‚É£ Abre el enlace en tu celular\n` +
                    `2Ô∏è‚É£ Autoriza el acceso a tu ubicaci√≥n GPS\n` +
                    `3Ô∏è‚É£ Acepta pedidos desde tu panel\n` +
                    `4Ô∏è‚É£ Contacta clientes por WhatsApp\n` +
                    `5Ô∏è‚É£ Marca entregas como completadas\n\n` +
                    `üõ∞Ô∏è MONITOREO GPS:\n` +
                    `‚Ä¢ Tu ubicaci√≥n solo se comparte cuando aceptes un pedido\n` +
                    `‚Ä¢ Puedes activar/desactivar el GPS cuando quieras\n` +
                    `‚Ä¢ El seguimiento es solo durante las entregas activas\n\n` +
                    `‚ö†Ô∏è IMPORTANTE:\n` +
                    `‚úÖ Guarda este enlace en tus favoritos\n` +
                    `‚úÖ Solo t√∫ puedes ver tus pedidos asignados\n` +
                    `‚úÖ Mant√©n el GPS activo durante entregas\n\n` +
                    `Al usar el sistema aceptas:\n` +
                    `‚Ä¢ Compartir ubicaci√≥n durante entregas activas\n` +
                    `‚Ä¢ Mantener comunicaci√≥n con clientes\n` +
                    `‚Ä¢ Reportar entregas completadas\n\n` +
                    `¬øTienes dudas? ¬°Escr√≠beme! üìû`
                );

                const cleanPhone = person.phone.replace(/\D/g, '');
                const phoneNumber = cleanPhone.length >= 10 ? cleanPhone.slice(-10) : null;

                if (phoneNumber) {
                    window.open(`https://wa.me/57${phoneNumber}?text=${message}`, '_blank');
                    showNotification('Invitaci√≥n enviada por WhatsApp', 'success');
                } else {
                    showNotification('N√∫mero de tel√©fono inv√°lido', 'error');
                }
            }, [showNotification]);

            const updateOrderStatus = useCallback((orderId, newStatus) => {
                setOrders(prev => prev.map(order => 
                    order.id === orderId 
                        ? { 
                            ...order, 
                            status: newStatus, 
                            updatedAt: new Date().toLocaleString()
                        }
                        : order
                ));

                const statusMessages = {
                    'en_transito': 'üöö Pedido enviado',
                    'entregado': '‚úÖ Pedido completado'
                };
                
                if (statusMessages[newStatus]) {
                    showNotification(statusMessages[newStatus], 'success');
                }
            }, [showNotification]);

            const completeDelivery = useCallback((orderId, deliveryTime, rating) => {
                setOrders(prev => prev.map(order => 
                    order.id === orderId 
                        ? { 
                            ...order, 
                            status: 'entregado', 
                            actualDeliveryTime: deliveryTime, 
                            rating: rating,
                            completedAt: new Date().toLocaleString(),
                            updatedAt: new Date().toLocaleString()
                        }
                        : order
                ));
                
                showNotification('üéâ Entrega completada exitosamente', 'success');
            }, [showNotification]);

            const metrics = calculateMetrics();

            const MetricCard = ({ title, value, icon: Icon, color, prefix = "", suffix = "" }) => (
                <div className="metric-card bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100 hover:border-gray-200 fade-in">
                    <div className="flex items-center justify-between">
                        <div className="flex-1">
                            <p className="text-sm font-medium text-gray-600 mb-1">{title}</p>
                            <p className="text-2xl font-bold text-gray-900 mb-1">
                                {prefix}{typeof value === 'number' ? formatNumber(value) : value}{suffix}
                            </p>
                        </div>
                        <div className="ml-4 flex-shrink-0">
                            <div 
                                className="w-12 h-12 rounded-xl flex items-center justify-center shadow-md"
                                style={{ backgroundColor: color + '15' }}
                            >
                                <Icon className="w-6 h-6" style={{ color }} />
                            </div>
                        </div>
                    </div>
                </div>
            );

            const tabs = [
                { id: 'dashboard', name: 'Dashboard', icon: TrendingUp },
                { id: 'orders', name: 'Pedidos', icon: Package },
                { id: 'delivery', name: 'Repartidores', icon: Users },
                { id: 'analytics', name: 'An√°lisis', icon: Star }
            ];

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <p>üöÄ Iniciando Sistema de Control de Domicilios...</p>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100">
                    {notifications.map(notification => (
                        <Notification
                            key={notification.id}
                            message={notification.message}
                            type={notification.type}
                            onClose={() => setNotifications(prev => prev.filter(n => n.id !== notification.id))}
                        />
                    ))}

                    <div className="bg-white shadow-lg border-b-2 border-gray-200">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center py-6">
                                <div className="flex items-center space-x-4">
                                    <div className="w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                                        <Package className="w-6 h-6 text-white" />
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-900">Control de Domicilios</h1>
                                        <p className="text-sm text-gray-600">Sistema de gesti√≥n profesional v2.0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white border-b-2 border-gray-100 sticky top-0 z-10 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <nav className="flex space-x-1 py-4">
                                {tabs.map(tab => {
                                    const Icon = tab.icon;
                                    const isActive = activeTab === tab.id;
                                    return (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`flex items-center space-x-2 px-4 py-3 rounded-lg text-sm font-medium transition-all duration-300 ${
                                                isActive 
                                                    ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg transform scale-105' 
                                                    : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                            }`}
                                        >
                                            <Icon className="w-4 h-4" />
                                            <span>{tab.name}</span>
                                        </button>
                                    );
                                })}
                            </nav>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {activeTab === 'dashboard' && (
                            <div className="space-y-8 fade-in">
                                <div className="text-center bg-gradient-to-r from-blue-50 via-purple-50 to-pink-50 rounded-2xl p-8 border-2 border-blue-100 shadow-lg">
                                    <h2 className="text-3xl font-bold text-gray-900 mb-3">
                                        üöÄ Dashboard de Control Profesional
                                    </h2>
                                    <p className="text-gray-600 text-lg max-w-3xl mx-auto">
                                        Gestiona tus domicilios con seguimiento en tiempo real y control total de tu operaci√≥n.
                                    </p>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                    <MetricCard
                                        title="Total Pedidos"
                                        value={metrics.totalOrders}
                                        icon={Package}
                                        color="#3B82F6"
                                    />
                                    <MetricCard
                                        title="Ingresos Totales"
                                        value={metrics.totalRevenue}
                                        icon={DollarSign}
                                        color="#10B981"
                                        prefix="$"
                                    />
                                    <MetricCard
                                        title="Tiempo Promedio"
                                        value={metrics.avgDeliveryTime}
                                        icon={Clock}
                                        color="#F59E0B"
                                        suffix=" min"
                                    />
                                    <MetricCard
                                        title="Calificaci√≥n"
                                        value={metrics.avgRating.toFixed(1)}
                                        icon={Star}
                                        color="#EF4444"
                                        suffix="/5"
                                    />
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-xl p-6 text-center shadow-lg">
                                        <div className="text-4xl font-bold text-green-600 mb-2">{metrics.completedOrders}</div>
                                        <div className="text-sm font-medium text-green-800">‚úÖ Entregados</div>
                                    </div>
                                    <div className="bg-gradient-to-r from-yellow-50 to-yellow-100 border-2 border-yellow-200 rounded-xl p-6 text-center shadow-lg">
                                        <div className="text-4xl font-bold text-yellow-600 mb-2">{metrics.pendingOrders}</div>
                                        <div className="text-sm font-medium text-yellow-800">üì¶ Pendientes</div>
                                    </div>
                                    <div className="bg-gradient-to-r from-blue-50 to-blue-100 border-2 border-blue-200 rounded-xl p-6 text-center shadow-lg">
                                        <div className="text-4xl font-bold text-blue-600 mb-2">{metrics.activeOrders}</div>
                                        <div className="text-sm font-medium text-blue-800">üöö En Tr√°nsito</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'orders' && (
                            <div className="space-y-6 fade-in">
                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                        <PlusCircle className="w-5 h-5 mr-2 text-blue-600" />
                                        Crear Nuevo Pedido
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Cliente *</label>
                                            <input
                                                type="text"
                                                placeholder="Nombre del cliente"
                                                value={newOrder.customerName}
                                                onChange={(e) => setNewOrder({...newOrder, customerName: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Direcci√≥n *</label>
                                            <input
                                                type="text"
                                                placeholder="Direcci√≥n de entrega"
                                                value={newOrder.address}
                                                onChange={(e) => setNewOrder({...newOrder, address: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Ciudad</label>
                                            <select
                                                value={newOrder.city}
                                                onChange={(e) => setNewOrder({...newOrder, city: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            >
                                                <option value="">Seleccionar ciudad</option>
                                                {colombianCities.map(city => (
                                                    <option key={city} value={city}>{city}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Valor del pedido *</label>
                                            <input
                                                type="number"
                                                placeholder="Ej: 25000"
                                                value={newOrder.orderValue}
                                                onChange={(e) => setNewOrder({...newOrder, orderValue: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Costo de env√≠o</label>
                                            <input
                                                type="number"
                                                placeholder="Ej: 3000"
                                                value={newOrder.deliveryFee}
                                                onChange={(e) => setNewOrder({...newOrder, deliveryFee: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Repartidor</label>
                                            <select
                                                value={newOrder.deliveryPerson}
                                                onChange={(e) => setNewOrder({...newOrder, deliveryPerson: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                                            >
                                                <option value="">Seleccionar repartidor</option>
                                                {deliveryPersons.map(person => (
                                                    <option key={person.id} value={person.name}>{person.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    <div className="mt-6">
                                        <button
                                            onClick={handleAddOrder}
                                            className="btn-primary text-white px-6 py-3 rounded-lg font-medium inline-flex items-center space-x-2 shadow-lg transform transition-transform hover:scale-105"
                                        >
                                            <PlusCircle className="w-4 h-4" />
                                            <span>Crear Pedido</span>
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100">
                                    <div className="px-6 py-4 border-b border-gray-200">
                                        <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                            <Package className="w-5 h-5 mr-2 text-blue-600" />
                                            Todos los Pedidos ({orders.length})
                                        </h3>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Direcci√≥n</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Valor</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {orders.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="5" className="px-6 py-12 text-center">
                                                            <Package className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                                            <p className="text-gray-500 text-lg">No hay pedidos registrados</p>
                                                        </td>
                                                    </tr>
                                                ) : (
                                                    orders.map(order => (
                                                        <tr key={order.id} className="hover:bg-gray-50">
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="font-medium text-gray-900">{order.customerName}</div>
                                                                <div className="text-xs text-gray-500">{order.createdAt}</div>
                                                            </td>
                                                            <td className="px-6 py-4">
                                                                <div className="text-sm text-gray-900">{order.address}</div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <div className="text-sm font-medium text-gray-900">${formatNumber(order.orderValue)}</div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`inline-flex px-3 py-1 text-xs font-medium rounded-full ${
                                                                    order.status === 'entregado' ? 'bg-green-100 text-green-800' :
                                                                    order.status === 'en_transito' ? 'bg-blue-100 text-blue-800' :
                                                                    'bg-yellow-100 text-yellow-800'
                                                                }`}>
                                                                    {order.status === 'entregado' ? '‚úÖ Entregado' :
                                                                     order.status === 'en_transito' ? 'üöö En Tr√°nsito' : 
                                                                     '‚è≥ Pendiente'}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                                {order.status === 'pendiente' && (
                                                                    <button
                                                                        onClick={() => updateOrderStatus(order.id, 'en_transito')}
                                                                        className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-medium"
                                                                    >
                                                                        Enviar
                                                                    </button>
                                                                )}
                                                                {order.status === 'en_transito' && (
                                                                    <button
                                                                        onClick={() => {
                                                                            const time = prompt('Tiempo de entrega (minutos):');
                                                                            const rating = prompt('Calificaci√≥n (1-5):');
                                                                            if (time && rating) {
                                                                                completeDelivery(order.id, time, rating);
                                                                            }
                                                                        }}
                                                                        className="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs font-medium"
                                                                    >
                                                                        Completar
                                                                    </button>
                                                                )}
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'delivery' && (
                            <div className="space-y-6 fade-in">
                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                        <Users className="w-5 h-5 mr-2 text-green-600" />
                                        Registrar Nuevo Repartidor
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Nombre *</label>
                                            <input
                                                type="text"
                                                placeholder="Nombre del repartidor"
                                                value={newDeliveryPerson.name}
                                                onChange={(e) => setNewDeliveryPerson({...newDeliveryPerson, name: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Tel√©fono</label>
                                            <input
                                                type="text"
                                                placeholder="+57 300 123 4567"
                                                value={newDeliveryPerson.phone}
                                                onChange={(e) => setNewDeliveryPerson({...newDeliveryPerson, phone: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Veh√≠culo</label>
                                            <select
                                                value={newDeliveryPerson.vehicle}
                                                onChange={(e) => setNewDeliveryPerson({...newDeliveryPerson, vehicle: e.target.value})}
                                                className="w-full border-2 border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                            >
                                                <option value="moto">Motocicleta</option>
                                                <option value="bicicleta">Bicicleta</option>
                                                <option value="carro">Autom√≥vil</option>
                                                <option value="pie">A pie</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="mt-6">
                                        <button
                                            onClick={handleAddDeliveryPerson}
                                            className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium inline-flex items-center space-x-2 shadow-lg"
                                        >
                                            <PlusCircle className="w-4 h-4" />
                                            <span>Agregar Repartidor</span>
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100">
                                    <div className="px-6 py-4 border-b border-gray-200">
                                        <h3 className="text-lg font-semibold text-gray-900 flex items-center">
                                            <Users className="w-5 h-5 mr-2 text-green-600" />
                                            Repartidores ({deliveryPersons.length})
                                        </h3>
                                    </div>
                                    <div className="p-6">
                                        {deliveryPersons.length === 0 ? (
                                            <div className="text-center py-12">
                                                <Users className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                                <p className="text-gray-500 text-lg">No hay repartidores registrados</p>
                                            </div>
                                        ) : (
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                {deliveryPersons.map(person => (
                                                    <div key={person.id} className="border-2 border-gray-200 rounded-lg p-6 hover:shadow-lg transition-all">
                                                        <div className="flex items-center justify-between mb-4">
                                                            <div className="flex items-center space-x-3">
                                                                <div className="w-12 h-12 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                                                                    <Users className="w-6 h-6 text-white" />
                                                                </div>
                                                                <div>
                                                                    <h4 className="font-bold text-gray-900">{person.name}</h4>
                                                                    <p className="text-sm text-gray-600">{person.phone}</p>
                                                                    <p className="text-xs text-gray-500 capitalize">{person.vehicle}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="text-sm text-gray-600 space-y-2 mb-4 p-3 bg-gray-50 rounded-lg">
                                                            <p className="flex justify-between">
                                                                <span>‚úÖ Entregas completadas:</span>
                                                                <span className="font-bold">{orders.filter(o => o.deliveryPerson === person.name && o.status === 'entregado').length}</span>
                                                            </p>
                                                            <p className="flex justify-between">
                                                                <span>üöö Pedidos activos:</span>
                                                                <span className="font-bold">{orders.filter(o => o.deliveryPerson === person.name && o.status !== 'entregado').length}</span>
                                                            </p>
                                                        </div>
                                                        <div className="flex flex-wrap gap-2">
                                                            <button
                                                                onClick={() => sendWhatsAppInvitation(person)}
                                                                className="flex-1 bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-xs font-medium flex items-center justify-center space-x-1 transition-colors"
                                                            >
                                                                <Send className="w-3 h-3" />
                                                                <span>Enviar Acceso</span>
                                                            </button>
                                                            <button
                                                                onClick={() => handleEditDeliveryPerson(person.id)}
                                                                className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-xs font-medium flex items-center justify-center transition-colors"
                                                            >
                                                                <Edit className="w-3 h-3" />
                                                            </button>
                                                            <button
                                                                onClick={() => handleDeleteDeliveryPerson(person.id)}
                                                                className="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-xs font-medium flex items-center justify-center transition-colors"
                                                            >
                                                                <Trash className="w-3 h-3" />
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'analytics' && (
                            <div className="space-y-6 fade-in">
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div className="bg-white rounded-xl shadow-lg border-2 border-gray-100 p-6">
                                        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                            <TrendingUp className="mr-2 text-blue-500" />
                                            An√°lisis de Rendimiento
                                        </h3>
                                        <div className="space-y-4">
                                            <div className="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                                <span className="text-gray-700 font-medium">Pedidos completados</span>
                                                <span className="font-bold text-green-600 text-lg">{metrics.completedOrders}</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                                <span className="text-gray-700 font-medium">Tasa de √©xito</span>
                                                <span className="font-bold text-blue-600 text-lg">{metrics.completionRate.toFixed(1)}%</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-orange-50 rounded-lg">
                                                <span className="text-gray-700 font-medium">Tiempo promedio</span>
                                                <span className="font-bold text-orange-600 text-lg">{metrics.avgDeliveryTime} min</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<DeliverySystem />, document.getElementById('root'));
    </script>
</body>
</html>